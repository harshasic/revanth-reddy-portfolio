"use strict";(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[1211],{808242:(e,t,r)=>{r.d(t,{Sh:()=>l,Vc:()=>o,jQ:()=>d,kw:()=>s});var i=r(380494),a=r(449572),n=r(59849);function o(e){let t=(0,a.bc)(n.oj8,{fileKey:e},{enabled:!!e});if(null!==t.data&&!t.data?.file?.plan){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No Plan found for file, key: "+e)};return i.Qw.error([t])}return t.transform(e=>e.file?.plan)}function s(e){let t=(0,a.bc)(n.X39,{fileKey:e},{enabled:!!e});if(null!==t.data&&!t.data?.file?.currentPlanUser){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No PlanUser found for file, key: "+e)};return i.Qw.error([t])}return t.transform(e=>e.file?.currentPlanUser)}function l(e){let t=(0,a.bc)(n.Fvs,{teamId:e},{enabled:!!e});if(null!==t.data&&!t.data?.team?.plan){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No Plan found for team, id: "+e)};return i.Qw.error([t])}return t.transform(e=>e.team?.plan)}function d(e){let t=(0,a.bc)(n.EyZ,{orgId:e},{enabled:!!e});if(null!==t.data&&!t.data?.org?.plan){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No Plan found for org, id: "+e)};return i.Qw.error([t])}return t.transform(e=>e.org?.plan)}},612953:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(408825),a=r(113139),n=r(869450);let o=i.z.object({js_url:i.z.string(),css_url:i.z.string()}),s=new class{constructor(){this.GetCachedPreviewUrlsValidator=(0,a.YV)("GetCachedPreviewUrlsValidator",(0,n.D)(o),null)}getCachedPreviewUrls(e){return this.GetCachedPreviewUrlsValidator.validate(async({xr:t})=>await t.get(`/api/make/${e.fileKey}/cached_preview_urls`,{source_code_hash:e.sourceCodeHash}))}}},472207:(e,t,r)=>{r.d(t,{e:()=>i});let i="https://go/figmascope-docs"},787538:(e,t,r)=>{r.d(t,{rf:()=>o,tV:()=>s,zG:()=>n});var i=r(104076),a=r(659062);function n(){return(0,i.jsx)(s,{children:(0,i.jsx)("p",{children:"Reading file..."})})}function o({error:e}){let t="Oops! Something went wrong";return"string"==typeof e?t=e:e instanceof Error&&(t=e.message,console.error(e)),(0,i.jsx)(s,{children:(0,i.jsx)("p",{style:a.sx.colorTextOndanger.colorBgDanger.p16.font20.maxW400.$,children:t})})}function s({children:e}){return(0,i.jsx)("div",{style:a.sx.fillPositionedContainer.flex.itemsCenter.justifyCenter.flexColumn.lh1_5Lines.font16.$,children:e})}},123315:(e,t,r)=>{r.d(t,{J:()=>tm});var i=r(104076),a=r(716976),n=r(187714),o=r(795033),s=r(883765),l=r(222714),d=r(221586),c=r(514223),u=r(659062),f=r(569963),p=r(284068),h=r(383947),g=r(432099),m=r(657878),y=r(377399),b=r(800108),v=(e=>(e[e.Fetched=0]="Fetched",e[e.Fetching=1]="Fetching",e[e.NeverFetched=2]="NeverFetched",e))(v||{});let k=(0,o.eU)(e=>{let t=e(m.OC);return"fullscreen"===t.view?`/api/file/scenegraph_validations/${t.fileKey}`:(0,y.E)(t)&&t.urlParams?.type==="server_file"?`/api/admin/scenegraph_validations/${t.urlParams.key}`:null}),S=(0,o.eU)(e=>null!=e(k)),N=(()=>{let e=(0,o.eU)((0,h.Ok)());return(0,o.eU)(t=>t(e),async(t,r)=>{let i;if(t(e).status===c.r.LOADING)return;let a=t(k);if(a){r(e,(0,h.ux)());try{i=await I(a)}catch(t){r(e,(0,h.uW)(t));return}r(e,(0,h.NY)(i))}})})();async function I(e){let t=await (0,g.GD)(e),r=new b._;for(let e of t.data.meta.data.results.violations)if("always-fail-for-testing"!==e.name)for(let t of e.instances)r.add(t.guid,t.message);return r}var w=r(617748),x=r(707425),O=r(787538),_=r(255054),C=r(843717),j=r(999083),P=r(266808),E=r(824570),F=r(957501),T=r.n(F),A=r(236631),J=r(911990),V=r(585627);let L=(0,x.Sv)("bookmarkSettings",{bookmarks:{}}),M=(0,o.eU)(e=>{let t=e(L),r=e(p.Cc).id;return new Set((t.bookmarks[r]??[]).map(e=>e.id))});function D(){let[e,t]=(0,o.fp)(L),r=(0,o.md)(p.Cc).id,i=a.useCallback(i=>{t({...e,bookmarks:{...e.bookmarks,[r]:i(e.bookmarks[r]||[])}})},[e,r,t]),n=a.useCallback((e,t)=>{i(r=>[...r,{id:e,name:t}])},[i]),s=a.useCallback(e=>{i(t=>t.filter((t,r)=>r!==e))},[i]),l=a.useCallback((e,t)=>{i(r=>r.map((r,i)=>i===e?{...r,name:t}:r))},[i]),d=a.useCallback((e,t)=>{i(r=>r.map((r,i)=>i===e?{...r,id:V.SW.fromString(t)}:r))},[i]);return{addBookmark:n,deleteBookmark:s,moveBookmarkDown:a.useCallback(e=>{i(t=>{if(e>=t.length-1)return t;let r=t.slice(),[i]=r.splice(e,1);return r.splice(e+1,0,i),r})},[i]),moveBookmarkUp:a.useCallback(e=>{i(t=>{if(e<=0)return t;let r=t.slice(),[i]=r.splice(e,1);return r.splice(e-1,0,i),r})},[i]),renameBookmark:l,updateBookmarkId:d,bookmarks:a.useMemo(()=>e.bookmarks[r]||[],[e,r])}}var K=r(674473);function R(e,t,r){return[...e.getObject(r)?.mapDescendants(e=>e.id)??[],...t?.getObject(r)?.mapDescendants(e=>e.id)??[]]}let U=(0,o.FZ)((0,o.eU)({}),(e,t,r)=>{let i=r(p.Cc),a=r(p.lX);switch(t.type){case"toggleExpanded":return(0,K.X9)(e,t.objectId,t.toggleSubtree?R(i,a,t.objectId):[]);case"expandAncestors":return(0,K.nE)(e,function(e,t,r){return[...e.getObject(r)?.mapAncestors(e=>e.id)??[],...t?.getObject(r)?.mapAncestors(e=>e.id)??[]]}(i,a,t.objectId),!0);case"expandDescendants":return(0,K.nE)(e,[t.objectId,...R(i,a,t.objectId)],!0);case"collapseDescendants":return(0,K.IO)(e,[t.objectId,...R(i,a,t.objectId)])}});var H=r(99723),G=r(382629),B=r(115069);let z=(0,o.eU)({status:"initial"}),$=(0,o.eU)(0),Y=(0,o.eU)(!1),X=(0,o.eU)(e=>{if(e(Y)){let t=e($);return`Indexing search results (this may take a moment)... [${t}/???]`}return null}),q=(0,x.Sv)("searchMode",x.Y6.Search),W=(0,o.eU)(e=>{let t=e(z),r=e(p.Cc),i=e(w.Sd);return"initial"===t.status?i.map(e=>r.getObject(e)).filter(G.Vq).map(e=>({object:e,matches:[]})).reverse():"results"in t&&t.results.length>0?t.results:null}),Z=(0,o.eU)(e=>{let t=e(z);if("searching"===t.status&&0===t.results.length){let t=["Searching..."],r=e(X);return r&&t.push(r),t}if("success"===t.status&&0===t.results.length){let t=["No results found."],r=e(p.Cc);return r instanceof B.G2&&t.push("Some content may be unavailable because of incremental loading"),"hide"===r.sensitiveTextPolicy&&t.push("Searching text fields is limited beacuse text redaction has been applied."),t}return"error"===t.status?["Error searching:",String(t.error)]:null}),Q=(0,o.eU)(e=>{if(e(q)!==x.Y6.Filter)return null;let t=e(z);return"results"in t?t.results.map(e=>e.object):null}),ee=(0,o.eU)(e=>{if(e(q)!==x.Y6.Filter)return null;let t=e(Z);return t?t.join(" "):null}),et=(0,x.Sv)("sortOrder",x.hX.Position),er=(0,o.eU)(e=>{let t=[x.hX.Position,x.hX.Name,x.hX.NodeId];return e(p.Cc).rootObjects[0]?.displayProperties.memoryFraction!=null&&t.push(x.hX.Memory),t.sort(),t}),ei=(0,o.eU)(e=>{switch(e(et)){case x.hX.Position:return en;case x.hX.Name:return ea;case x.hX.Memory:return es;case x.hX.NodeId:return eo}});function ea(e,t){return e.displayProperties.name.localeCompare(t.displayProperties.name)}function en(e,t){let[r,i]=el(e,t);if(r&&i){let e=r.parentIndex?.position,t=i.parentIndex?.position;if(null==e&&null==t)return 0;if(null==t)return 1;if(null==e)return -1;if(e<t)return -1;else if(e>t)return 1}return ea(e,t)}function eo(e,t){let[r,i]=el(e,t);if(r&&i){let{sessionID:e,localID:t}=r.guid??{localID:-1,sessionID:-1},{sessionID:a,localID:n}=i.guid??{localID:-1,sessionID:-1};return e-a||t-n}return en(e,t)}function es(e,t){return(t.displayProperties.memoryFraction??0)-(e.displayProperties.memoryFraction??0)||en(e,t)}function el(e,t){return"nodeChange"in e&&"nodeChange"in t?[e.nodeChange,t.nodeChange]:[null,null]}var ed=r(727989),ec=r(403671),eu=r(110178),ef=r(665261),ep=r(192075),eh=r(770484),eg=r(66293);let em=ef.ms,ey=ef.c$,eb=ef.wv;function ev({contextMenuData:{objectId:e,position:t},onClose:r}){let[n,s]=a.useState(0),l=t.left,d=t.top+n>window.innerHeight?t.top-n:t.top,{canSelectInApp:c,selectInApp:h}=a.useContext(w.H$),g=a.useRef(null);(0,eu.ww)(g,r);let m=(0,o.md)(p.Cc).getObject(e),y=m instanceof eg.R?m:null,b=m instanceof eh.E?m:null,[v,k]=(0,o.fp)(f.Oz),S=(0,o.Xr)(U);if(null==m)return null;let N=e=>()=>{e(),r()},I=m.children.length>0,x=(()=>{if(c?.(m))return N(()=>h(m))})(),O=e=>N(()=>P.glU.triggerAction(e,{guid:m.id})),_=v?.object.id===m.id;return(0,i.jsx)(em,{style:{...u.sx.fixed.$,left:l,top:d},dropdownRef:e=>{e&&s(e.clientHeight)},children:(0,i.jsxs)("div",{ref:g,children:[x&&(0,i.jsx)(ey,{onClick:x,children:"Jump to node"}),I&&(0,i.jsx)(ey,{onClick:N(()=>S({type:"expandDescendants",objectId:e})),children:"Expand descendants"}),I&&(0,i.jsx)(ey,{onClick:N(()=>S({type:"collapseDescendants",objectId:e})),children:"Collapse descendants"}),(x||I)&&(0,i.jsx)(eb,{}),_&&(0,i.jsx)(ey,{onClick:N(()=>k({type:"clear"})),children:"Stop diffing against this node"}),(!_||v?.type!==f.Lp.Layer)&&(0,i.jsx)(ey,{onClick:N(()=>k({type:"start",diffType:f.Lp.Layer,id:e})),children:"Layer diff against this node"}),(!_||v?.type!==f.Lp.Tree)&&(0,i.jsx)(ey,{onClick:N(()=>k({type:"start",diffType:f.Lp.Tree,id:e})),children:"Tree diff against this node"}),y&&(0,i.jsx)(eb,{}),y&&(0,i.jsx)(ey,{onClick:N(()=>{let e=JSON.stringify(y.nodeChange,null,2);navigator.clipboard.writeText(e)}),children:"Copy NodeChange JSON"}),b&&"DOCUMENT"!==b.type&&"CANVAS"!==b.type&&(0,i.jsx)(ey,{onClick:O("debug-print-as-test-code"),children:(0,ep.tx)("fullscreen_actions.debug-print-as-test-code")}),b&&"VECTOR"===b.type&&(0,i.jsx)(ey,{onClick:O("debug-print-vector-network-as-test-code"),children:(0,ep.tx)("fullscreen_actions.debug-print-vector-network-as-test-code")})]})})}var ek=r(62084);let eS=a.memo(function({diffType:e,id:t,primaryId:r,secondaryId:n,leftBadges:o,indent:s,index:l,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:f,memoryFraction:p,rightBadges:h,name:g,style:m,select:y,toggle:b,showContextMenu:v}){let k=a.useCallback(e=>{e.preventDefault(),v({objectId:t,position:{left:e.clientX,top:e.clientY}})},[t,v]);return(0,i.jsxs)(ek.Z,{changeType:e,indent:s,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:f,keyboardNavigationPath:[l],onContextMenu:k,onMouseEnter:()=>{P.Ez5&&P.Ez5.editorState().figmaScopeHighlightedNode.set(t)},onMouseLeave:()=>{P.Ez5&&P.Ez5.editorState().figmaScopeHighlightedNode.set("")},select:()=>y(t),style:m,toggleExpanded:e=>b(t,e),children:[(0,i.jsx)(ed.IV,{badges:o}),(0,i.jsx)(ec.nK,{id:r}),n&&(0,i.jsx)(ec.nK,{id:n,secondary:!0}),(0,i.jsx)("div",{title:g,className:A.s.ellipsis.noWrap.overflowHidden.$,children:g}),(0,i.jsx)(J.M,{}),(0,i.jsx)(ed.IV,{badges:h}),null!=p&&(0,i.jsxs)("span",{className:A.s.colorTextSecondary.$,title:"Node memory usage",children:[(100*p).toFixed(3),"%"]})]})});function eN({style:e,data:{displayedObjects:t,selectedId:r,selectedIds:a,...n},index:o}){let s=t[o],l=(0,E.zN)(e);return(0,i.jsx)(eS,{...s,...n,isSelected:r===s.id,isSelectedSecondary:!!s&&a.includes(s.id),style:l,index:o})}let eI=[];function ew({appSelection:e}){let t=(0,o.md)(ex),[r,n]=(0,o.fp)(w.AJ),s=(0,E.k9)(()=>e?.guids??eI,[e?.guids]),[l,d]=a.useState(null),c=a.useRef(null);a.useEffect(()=>{let e=t.findIndex(e=>e.id===r);e>=0&&c.current?.scrollToItem(e,"smart")},[t,r]);let u=(0,o.Xr)(U);a.useEffect(()=>{u({type:"expandAncestors",objectId:r})},[u,r]);let f=a.useCallback((e,t)=>{u({type:"toggleExpanded",objectId:e,toggleSubtree:t})},[u]),p=(0,o.md)(ee);return 0===t.length?(0,i.jsx)("div",{children:p??"Empty Scene"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.A,{disableWidth:!0,children:({height:e})=>(0,i.jsx)(C.Y1,{itemSize:18,itemCount:t.length,height:e,ref:c,itemData:{displayedObjects:t,selectedId:r,selectedIds:s,select:n,toggle:f,showContextMenu:d},width:"100%",children:eN})}),l&&(0,i.jsx)(ev,{contextMenuData:l,onClose:()=>{d(null)}})]})}let ex=(0,o.eU)(e=>{let t=e(M),r=e(p.Cc);return(e(eO)??e(e_)).map(e=>({...e,rightBadges:[...e.rightBadges,...t.has(e.id)?[{type:"bookmark",value:"Bookmarked"}]:[],...r.getAdditionalBadges?.(e.id)||[]]}))}),eO=(0,o.eU)(e=>{let t=e(Q);return t?t.map(e=>({...e.displayProperties,diffType:void 0,id:e.id,indent:0,isExpanded:!1,isLeaf:!0})):null}),e_=(0,o.eU)(e=>{let t=e(p.Cc).rootObjects,r=e(f.sg),i=e(U),a=e(ei),n=(()=>{switch(r.type){case f.Lp.Tree:return[r.object];case f.Lp.Full:return r.resource.rootObjects;default:return[]}})(),o={sortFn:a,expandedIds:i};return T()(t,e=>{if(!e)return[];if(0===n.length)return eC(e,0,o);let t=eP(e,n);return t?ej(e,t,0,o):function e(t,r,i,a){let n=t.id,o=t.children,s=0===o.length,l=!!a.expandedIds[n],d=!1,c=T()(o,t=>{let n=(()=>{let n=eP(t,r);if(n)return ej(t,n,i+1,a);let o=r.filter(e=>e.someAncestor(e=>e.id===t.id,{includeSelf:!0}));return o.length>0?e(t,o,i+1,a):eC(t,i+1,a)})();return d=d||n[0]?.diffType!=null,n}),u={...t.displayProperties,diffType:d?"CHILD_MODIFIED":void 0,id:n,indent:i,isExpanded:l,isLeaf:s};return l?[u,...c]:[u]}(e,n,0,o)})});function eC(e,t,r){let i=e.id,a=e.children,n=0===a.length,o=!!r.expandedIds[i],s={...e.displayProperties,diffType:void 0,id:i,indent:t,isExpanded:o,isLeaf:n};return o?[s,...T()(eE(a,r.sortFn),e=>eC(e,t+1,r))]:[s]}function ej(e,t,r,i){let a=e??t;if(!a)throw Error("Diffing two nothings");if(e&&t&&e.id!==t.id)throw Error("Diffing nodes with mismatched keys");let n=a.id,o=eE(e?.children??[],i.sortFn),s=eE(t?.children??[],i.sortFn),l=(0,j.TR)(o,s,e=>e.id),d=!1,c=T()(l,({left:e,right:t})=>{let a=ej(e,t,r+1,i);return d=d||a[0]?.diffType!=null,a}),u=(0,f.wc)(e,t,d),p=e?.displayProperties.name,h=t?.displayProperties.name,g=null!=p&&null!=h&&p!==h?`${p} <=> ${h}`:a.displayProperties.name,m=!!i.expandedIds[n],y={...a.displayProperties,diffType:u,id:n,indent:r,isExpanded:m,isLeaf:0===l.length,name:g};return m?[y,...c]:[y]}function eP(e,t){return t.find(t=>t.id===e.id)}function eE(e,t){return e.slice().sort(t)}var eF=r(307829),eT=r(420680),eA=r(32557);r(120440);var eJ=r(826220),eV=r(268389),eL=r(162954),eM=r(208754),eD=r(760238),eK=r(368422),eR=r(927287),eU=r(36758),eH=r(523657),eG=r(390579);function eB(e){let{bookmarks:t,deleteBookmark:r,moveBookmarkDown:n,moveBookmarkUp:o,renameBookmark:s,updateBookmarkId:l}=D();return(0,i.jsx)(eJ.bL,{defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},onClose:e.onClose,width:400,children:(0,i.jsxs)(eV.vo,{children:[(0,i.jsx)(eV.Y9,{children:(0,i.jsx)(eV.hE,{children:"FigmaScope Bookmarks"})}),(0,i.jsx)(eV.nB,{children:(0,i.jsxs)(eL.bL,{className:"xrvj5dj x1nfngrj",children:[0===t.length&&(0,i.jsx)("div",{className:"x6s0dn4 x78zum5 xpyat2d xl56j7k",children:"No bookmarks"}),t.length>0&&(0,i.jsxs)(eM.fI,{className:"xrvj5dj xuhvigx xg2d0mh",children:[(0,i.jsx)(eD.fh,{children:"Name"}),(0,i.jsx)(eD.fh,{children:"ID"})]}),t.map((e,d)=>(0,a.createElement)(eM.fI,{className:"xrvj5dj xuhvigx xg2d0mh",key:d},(0,i.jsx)(eD.fh,{children:(0,i.jsx)(eK.p,{id:`edit-bookmark-name-${d}`,value:e.name,onChange:e=>s(d,e)})}),(0,i.jsx)(eD.fh,{children:(0,i.jsx)(eK.p,{id:`edit-bookmark-id-${d}`,value:e.id,onChange:e=>l(d,e)})}),(0,i.jsx)(eD.fh,{children:(0,i.jsxs)(eR.e,{"aria-label":`Bookmark actions for ${e.name}`,children:[(0,i.jsx)(eT.K,{"aria-label":"Delete bookmark",onClick:()=>r(d),children:(0,i.jsx)(eU.i,{})}),(0,i.jsx)(eT.K,{"aria-label":"Move bookmark up",disabled:0===d,onClick:()=>o(d),children:(0,i.jsx)(eH.t,{})}),(0,i.jsx)(eT.K,{"aria-label":"Move bookmark down",disabled:d===t.length-1,onClick:()=>n(d),children:(0,i.jsx)(eG.O,{})})]})})))]})})]})})}function ez(){let[e,t]=(0,o.fp)(w.AJ),r=(0,o.md)(w.gg),{getTriggerProps:n,manager:s}=eF.b(),{addBookmark:l,bookmarks:d}=D(),[c,u]=a.useState(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(eF.bL,{manager:s,children:[(0,i.jsx)("div",{className:"xrybvsa",children:(0,i.jsx)(eT.K,{...n(),"aria-label":"bookmarks",children:(0,i.jsx)(eA.j,{})})}),(0,i.jsxs)(eF.mc,{children:[(0,i.jsxs)(eF.YJ,{title:(0,i.jsx)(eF.r1,{children:"Bookmark settings"}),children:[(0,i.jsx)(eF.q7,{onClick:()=>{let t=r?.displayProperties.name??"Bookmark";l(e,`${t} - ${e}`)},children:"Add bookmark"}),(0,i.jsx)(eF.q7,{onClick:()=>{u(!0)},children:"Manage bookmarks"})]}),d.length?(0,i.jsx)(eF.YJ,{title:(0,i.jsx)(eF.r1,{children:"Bookmark list"}),children:d.map((e,r)=>(0,i.jsx)(eF.q7,{onClick:()=>{t(e.id)},children:e.name},r))}):null]})]}),c&&(0,i.jsx)(eB,{onClose:()=>u(!1)})]})}var e$=r(511570),eY=r.n(e$),eX=r(150062),eq=r(848561);function eW({searchRef:e}){let t=(0,o.Xr)(w.AJ),r=(0,o.md)(W),n=(0,o.md)(Z),[s,l]=a.useState(!1),d=(0,o.md)(q)!==x.Y6.Filter&&s,c=a.useRef(null);(0,eu.ww)(c,()=>l(!1));let u=a.useCallback(e=>{l(!1),t(e.object.id)},[l,t]);return(0,i.jsxs)(eq.dP,{className:A.s.flex1.$,ref:c,allowVim:!0,children:[(0,i.jsx)(eZ,{searchRef:e,setShowSearchResults:l}),d&&(r?(0,i.jsx)(e0,{searchResults:r,selectResult:u}):n?(0,i.jsx)(e1,{text:n}):null)]})}function eZ({searchRef:e,setShowSearchResults:t}){let r=(0,o.md)(q),n=function(){let e=(0,o.md)(p.Cc),t=(0,o.Xr)(z),r=(0,o.Xr)($),i=(0,o.Xr)(Y),n=a.useRef(0),s=a.useMemo(()=>(0,H.s)(a=>{let o=++n.current;i(!0);let s=new TaskController({priority:"user-visible"});scheduler.postTask(()=>i(!0),{signal:s.signal,delay:300}).catch(()=>{});let l=e.getObject(a);l&&t({status:"searching",results:[{object:l,matches:[{value:a,property:"id",isExact:!0}]}]}),e.getSearch(r).then(e=>e.searchWithText(a)).then(e=>{s.abort(),o===n.current&&t({status:"success",results:e})}).catch(e=>{console.error(e),s.abort(),o===n.current&&t({status:"error",error:e})})},200),[e,r,t,i]);return a.useCallback(e=>0===e.length?t({status:"initial"}):s(e),[s,t])}(),{setKeyboardNavigationElement:s}=(0,eq.M3)({path:[0,0],id:"input"});return(0,i.jsx)("input",{ref:t=>{s(t),e.current=t},type:"text",placeholder:r,className:"search_bar--searchBar--qnpUm",onChange:e=>n(e.target.value),onFocus:()=>t(!0)})}function eQ({children:e}){return(0,i.jsx)("div",{className:A.s.absolute.zIndexModal.colorBg.b1.colorBorder.mt2.overflowAuto.$,style:{maxHeight:450,minWidth:500,boxShadow:"0px 2px 14px var(--color-shadow, rgba(0, 0, 0, 0.15))"},children:e})}function e0({searchResults:e,selectResult:t}){return(0,i.jsx)(eQ,{children:e.map((e,r)=>(0,i.jsx)(e2,{result:e,index:r,onClick:()=>t(e)},e.object.id))})}function e1({text:e}){return(0,i.jsx)(eQ,{children:(Array.isArray(e)?e:[e]).map((e,t)=>(0,i.jsx)("div",{className:A.s.colorBg.colorTextSecondary.px8.py4.$,children:e},t))})}function e2({result:e,index:t,onClick:r}){let{object:n,matches:o}=e,{displayProperties:s}=n,{setKeyboardNavigationElement:l,keyboardNavigationItem:d,isFauxFocused:c}=(0,eq.M3)({path:[1,t],id:n.id});return a.useEffect(()=>{d&&0===t&&d.fauxFocus()},[d,t]),(0,i.jsx)("button",{ref:l,className:eY()(A.s.block.wFull.px4.py8.colorText.flex.itemsCenter.alignLeft.$,"search_bar--searchResult--0iOvc",c&&"search_bar--fauxFocus--BYHwu"),onClick:r,children:(0,i.jsxs)(J.Y,{spacing:4,children:[(0,i.jsx)(ed.IV,{badges:s.leftBadges}),(0,i.jsx)(ec.nK,{id:n.displayProperties.primaryId}),(0,i.jsx)(eX.R,{className:A.s.overflowHidden.$,text:s.name}),(0,i.jsx)(J.M,{}),o.filter(({property:e})=>!["id","guid","name","type","phase"].includes(e)).map(({property:e,value:t},r)=>(0,i.jsxs)(J.Y,{spacing:4,width:"hug-contents",children:[(0,i.jsxs)("div",{children:[e,":"]}),(0,i.jsx)("div",{children:t})]},r))]})})}var e3=r(652539);function e5({children:e}){return(0,i.jsx)("div",{className:A.s.colorBorder.px8.py4.bb1.bSolid.$,children:(0,i.jsx)(J.Y,{children:e})})}function e7(e){let t={className:"toolbar_components--iconButton--1-XNe",children:(0,i.jsx)(e3.B,{svg:e.svg}),title:e.label,"aria-label":e.label};return"href"in e?(0,i.jsx)("a",{...t,href:e.href,target:"blank"}):(0,i.jsx)("button",{...t,onClick:e.onClick,disabled:e.disabled})}var e4=r(129503),e8=r(718668);function e6({searchRef:e}){let[t,r]=(0,o.fp)(w.jI),[n,l]=(0,o.fp)(w.JN),d=!!a.useContext(w.H$).selectInApp,[c,u]=(0,o.fp)(q),[f,p]=(0,o.fp)(w.bA),[h,g]=(0,o.fp)(et),m=(0,o.md)(er);return(0,i.jsxs)(e5,{children:[(0,i.jsx)(eW,{searchRef:e}),(0,i.jsxs)("select",{name:"filter-or-search",title:"Determines whether the text box searches or filters",onChange:e=>{u(e.target.value)},defaultValue:c,children:[(0,i.jsx)("option",{value:x.Y6.Search,children:"Search"}),(0,i.jsx)("option",{value:x.Y6.Filter,children:"Filter"})]}),(0,i.jsx)("select",{name:"sort",title:"Sets the left panel sort order",onChange:e=>{let t=e.target.value;s.az.trackDefinedEvent("figmascope.sort_order_change",{order:function(e){switch(e){case x.hX.Position:return"position";case x.hX.Name:return"name";case x.hX.Memory:return"memory";case x.hX.NodeId:return"node_id"}}(t)}),g(t)},defaultValue:h,children:m.map(e=>(0,i.jsxs)("option",{value:e,children:["Sort by ",e]},e))}),d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{name:"follow-selection",type:"checkbox",checked:f,onChange:e=>p(e.target.checked)}),(0,i.jsx)("label",{htmlFor:"follow-selection",children:"Follow"})]}),(0,i.jsx)(e7,{label:"Select Previous",onClick:()=>{r(),s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"button"})},disabled:!t,svg:e4.A}),(0,i.jsx)(e7,{label:"Select Next",onClick:()=>{l(),s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"button"})},disabled:!n,svg:e8.A}),(0,i.jsx)(ez,{})]})}var e9=r(815701),te=r(577693),tt=r(555013),tr=r(472207),ti=r(380980),ta=r(458609),tn=r(619883),to=r(821527);function ts({selectedObject:e,diffObject:t,onClose:r}){let a=(0,o.md)(S),[n,s]=(0,o.fp)(f.Oz);return(0,i.jsxs)(e5,{children:[e?n&&t?(0,i.jsx)(tc,{selectedObject:e,diffObject:t,diffState:n,setDiffState:s}):(0,i.jsx)(td,{object:e}):t?(0,i.jsx)(td,{object:t}):(0,i.jsx)(J.M,{}),a&&(0,i.jsx)(tu,{}),(0,i.jsx)(e7,{label:"Help",href:tr.e,svg:ti.A}),r&&(0,i.jsx)(e7,{label:"Close FigmaScope",onClick:r,svg:to.A})]})}let tl=A.s.flex1.ml10.my4.$;function td({object:e}){return(0,i.jsx)("div",{className:tl,children:(0,i.jsx)("span",{className:A.s.fontSemiBold.$,children:e.displayProperties.longName})})}function tc({selectedObject:e,diffObject:t,diffState:r,setDiffState:a}){let n=(0,o.Xr)(w.AJ);return(0,i.jsxs)("div",{className:A.s.flex1.ml10.my4.$,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:A.s.colorTextSecondary.$,children:"Diffing "}),(0,i.jsx)("span",{className:A.s.fontSemiBold.$,children:e.displayProperties.longName}),(0,i.jsx)("span",{className:A.s.colorTextSecondary.$,children:" against "}),(0,i.jsx)("span",{className:A.s.fontSemiBold.$,children:t.displayProperties.longName})]}),r&&(0,i.jsx)("div",{className:A.s.colorTextSecondary.mt8.$,children:(0,i.jsxs)(J.Y,{spacing:8,width:"hug-contents",height:"hug-contents",verticalAlignItems:"start",children:[(0,i.jsxs)("span",{children:["Snapshot of"," ",(0,i.jsx)(tt.CY,{onClick:()=>n(r.object.id),className:A.s.colorTextFigjam.fontSemiBold.$,trusted:!0,children:r.object.displayProperties.name}),r.type===f.Lp.Tree&&" and full subtree"," was taken at"," ",r.time.toLocaleTimeString("en-US")]}),(0,i.jsx)(tt.CY,{onClick:()=>a({type:"refresh"}),className:A.s.colorTextDesign.$,trusted:!0,children:"Refresh"}),(0,i.jsx)(tt.CY,{onClick:()=>a({type:"clear"}),className:A.s.colorTextDanger.$,trusted:!0,children:"Finish"})]})})]})}function tu(){let[e,t]=(0,o.fp)(N),r=e.status===c.r.LOADING;return a.useEffect(()=>{t()},[t]),(0,i.jsx)(e7,{label:r?"Fetching scene graph validation failures":"Refetch scenegraph validation failures",onClick:t,svg:r?ta.A:tn.A})}var tf=r(171660);function tp({children:e}){return(0,i.jsx)("div",{className:A.s.hFull.$,children:(0,i.jsxs)(J.Y,{direction:"vertical",width:"fill-parent",height:"fill-parent",padding:0,spacing:0,children:[(0,i.jsx)(th,{}),e]})})}function th(){let{name:e,metadata:t}=(0,o.md)(p.Cc);return(0,i.jsxs)(J.Y,{direction:"horizontal",width:"fill-parent",height:32,padding:8,spacing:32,backgroundColor:"toolbar",children:[e&&(0,i.jsx)(tf.E,{fontWeight:"bold",color:"toolbar",children:e}),t&&Object.entries(t).map(([e,t])=>t&&(0,i.jsxs)("span",{children:[(0,i.jsxs)(tf.E,{color:"toolbar-secondary",children:[e,": "]}),(0,i.jsx)(tf.E,{color:"toolbar",fontFamily:"monospace",fontWeight:"bold",children:t})]},e))]})}var tg=r(753639);let tm=a.memo(function({embedded:e=!1,emptyStateContent:t,onClose:r,appSelection:a,setAppSelection:n}){let s=(0,o.md)(p.lu);switch(s.status){case c.r.INIT:return t??(0,i.jsx)(O.zG,{});case c.r.LOADING:return(0,i.jsx)(O.zG,{});case c.r.FAILURE:return(0,i.jsx)(O.rf,{error:s.error});case c.r.SUCCESS:}if(0===s.value.primaryResource.rootObjects.length)return(0,i.jsx)(O.rf,{error:"No root objects found. This is likely a bug - please report in #figmascope."});let l=(0,i.jsx)(ty,{appSelection:a,setAppSelection:n,onClose:r});return e?l:(0,i.jsx)(tp,{children:l})});function ty({onClose:e,appSelection:t,setAppSelection:r}){let h=a.useRef(null),g=a.useRef(null),{windowInnerWidth:m}=(0,l.l)(),[y,b]=(0,o.fp)(tb),[v,k]=(0,o.fp)(tv),[S,I]=(0,n.i)({onDrag(e){let t=e.clientX/m;b(`${(100*t).toFixed(2)}%`)}}),[x,O]=(0,n.i)({onDrag(e){let t=g.current;if(!t)return;let r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth;k(`${(100*r).toFixed(2)}%`)}}),_=(0,o.Xr)(w.jI),C=(0,o.Xr)(w.JN),j=a.useCallback(e=>{let t=h.current;document.activeElement!==t&&(e.keyCode===d.Uz.FORWARD_SLASH&&t?(t.focus(),e.preventDefault()):e.keyCode===d.Uz.BRACKET_LEFT?(s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"keyboard"}),_()):e.keyCode===d.Uz.BRACKET_RIGHT&&(s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"keyboard"}),C()))},[_,C]),P=(0,o.md)(p.Cc);window.figmaScope=P,window.figmaScopeScene=P,function(e){let[t,r]=(0,o.fp)(N);t.status===c.r.SUCCESS&&e?.setSceneGraphValidationInfo?.(t.value),(0,a.useEffect)(()=>{r()},[r])}(P);let E=(0,o.md)(w.AJ),F=(0,o.md)(w.gg),T=(0,o.md)(f.tH);return(0,i.jsx)(w.q,{appSelection:t,setAppSelection:r,children:(0,i.jsxs)("div",{className:tg.zr,style:u.sx.if(S||x,{cursor:"ew-resize"}).$,onKeyDown:j,children:[(0,i.jsxs)("div",{className:tg.Pd,style:{width:y},children:[(0,i.jsx)(e6,{searchRef:h}),(0,i.jsxs)(e9.o,{className:tg._H,children:[(0,i.jsx)("div",{...I({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,i.jsx)(ew,{appSelection:t})]})]}),(0,i.jsxs)("div",{className:tg.io,children:[(0,i.jsx)(ts,{selectedObject:F,diffObject:T,onClose:e}),(F||T)&&(0,i.jsxs)("div",{className:tg._t,ref:g,children:[(0,i.jsxs)(e9.o,{className:tg.S3,style:{width:v},children:[(0,i.jsx)("div",{...O({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,i.jsx)(te.P,{panel:"middle",items:F?.rawProperties,diffItems:T?.rawProperties,extraItems:void 0},E)]}),(0,i.jsx)(e9.o,{className:tg.xK,children:(0,i.jsx)(te.P,{panel:"right",items:F?.computedProperties,diffItems:T?.computedProperties,extraItems:P.getAdditionalProperties?.(E)},E)})]})]})]})})}let tb=(0,x.Sv)("leftPanelWidth","35%"),tv=(0,x.Sv)("rightPanelWidth","50%")},989282:(e,t,r)=>{r.d(t,{q:()=>d});var i=r(547115),a=r(520199),n=r(743072),o=r(442218),s=r(338052);let l=new Map,d=(0,s.n)(async e=>{let{fileKey:t,context:r,plan:s}=e,d="ai_assistant"===r?a.fC:a.Tv,c=s.planRecordId;if(!c){let e="No plan record id, cannot create thread";return(0,a.fL)(new d(e),"create_thread_record",{fileKey:t}),{status:"error",error:e}}let u=async()=>{let s=n.J.createVital(`${r}.chat_sdk.thread_creation_time`,{level:i.$b.INFO});s.start();let l=await (0,a.kA)(s,()=>o.NH.createThread({fileKey:t,planId:c,privacyMode:"code_chat"===r?"file":"user",nodeGuid:"code_chat"===r?e.isOldFile?"old_file":e.nodeGuid:void 0}));if(s.stop(),!l.success){let{statusCode:e,cause:r,errorData:i}=l,n=`ApiAiChat.createThread failed, status: ${e}`;return(0,a.fL)(new d(n),"create_thread_record",{fileKey:t,statusCode:e,cause:r,errorData:i}),{status:"error",error:n}}return l.data.meta.alreadyExists&&(0,a.fL)(new d("ApiAiChat.createThread succeeded but thread already exists"),"create_thread_record",{fileKey:t,threadId:l.data.meta.threadId}),{status:"created",threadId:l.data.meta.threadId,isOldFile:"code_chat"===r&&e.isOldFile}};if("code_chat"!==r)return await u();{let i=`${t}:${r}:${e.nodeGuid}`;return await function(e,t){let r=l.get(e);if(r)return r;let i=(async()=>{try{return await t()}finally{l.delete(e)}})();return l.set(e,i),i}(i,u)}})},347692:(e,t,r)=>{if(r.d(t,{G:()=>a}),443==r.j)var i=r(612691);function a(e){return"org"===e.tier||"enterprise"===e.tier?(0,i.z)("make_chat_sdk_phase1_org"):"pro"===e.tier||"student"===e.tier?(0,i.z)("make_chat_sdk_phase1_pro"):(0,i.z)("make_chat_sdk_phase1_starter")}},318648:(e,t,r)=>{r.d(t,{bg:()=>S,th:()=>v,p:()=>N,sc:()=>k,dJ:()=>b,Sw:()=>y});var i=r(716976),a=r(405242),n=r(370012),o=r(400045),s=r(723584);let l=(e,t,r)=>{let i=t.safeParse(r);if(!i.success){let t=Object.keys(r);throw new o.T(`Failed to parse ${e} message part. Type: ${r.type}. Keys: ${t.join(", ")}. Error: ${i.error.message}`)}return i.data};var d=r(795033),c=r(333331),u=r(520199),f=r(449572),p=r(211862),h=r(592726),g=r(59849);function m(e){return i.useMemo(()=>"errors"!==e.status?[]:e.errors.filter(e=>!e.retriable),[e.status,e.errors])}function y({isEnabled:e,fileKey:t,nodeGuid:r}){let a=(0,h.iZ)(),n=e&&t&&r&&a,o=(0,f.Rs)((0,g.Zrv)(n?{ownerId:t,nodeGuid:r}:null)),s=c.oA(o.data?.nodeAiChatThreads)?.[0],l=m(o);return i.useEffect(()=>{e&&0!==l.length&&(0,u.fL)(new u.Tv("Errors occurred while querying Livegraph NodeAiChatThreadsView"),"nodeaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(l),fileKey:t,nodeGuid:r})},[e,l,t,r]),{threadId:s?.id??null,isOldFile:s?"old_file"===s.nodeGuid:null,subscriptionStatus:o.status,latestUserMessage:s?.latestUserMessage??null}}function b(e,t,r,a,n){let o=(0,f.Rs)((0,g.r3i)(e?{ownerId:e}:null)),s=m(o);i.useEffect(()=>{0!==s.length&&(0,u.fL)(new u.fC("Errors occurred while querying Livegraph FileAiChatThreadsView"),"fileaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(s),fileKey:e})},[s,e]);let l=o.data?.fileAiChatThreads?.[0]?.id??null,d="loaded"!==o.status,[p,h]=i.useState(null),y=p??l,b=e&&y?{ownerId:e,id:y}:null,k=(0,f.Rs)((0,g.A6w)(b)),S=(0,c.oA)(k.data?.activeAiChatThread);return i.useEffect(()=>{if(!S||!y||n)return;let e=S.messages.map(v);h(e=>(e!==y&&(0,u.pF)(`Livegraph threadId updating: ${e} => ${y}`),y));let i=a();e.length>i.length+t&&((0,u.pF)("LiveGraph ActiveAiChatThread updating =>",e),r(e))},[S,a,r,y,t,n,h]),{threadId:n?null:y,setThreadId:h,isLoadingThreadId:d}}function v(e){let t=(e.parts??[]).map(({partType:e,contentPb:t,blobstoreContentKey:r})=>{if(!(0,a.pQ)(e))return(0,u.D5)(`Unknown message part type when converting Livegraph message to AiChatMessage: ${e}. This part will be ignored.`),null;let{type:i,...o}=(0,a.H)(e,t);return(0,n.N)({type:i,contentJson:o,blobstoreContentKey:r})}).filter(e=>null!==e);return function({role:e,content:t,...r}){return{...(()=>{switch(e){case"user":return{role:e,content:t.map(t=>l(e,s.Fd,t))};case"assistant":return{role:e,content:t.map(t=>l(e,s.G4,t))};case"tool":return{role:e,content:t.map(t=>l(e,s.iS,t))};case"system":return{role:e,content:t.map(t=>l(e,s.jV,t))};default:throw new o.T(`Unknown message role: ${e}`)}})(),...r}}({role:e.role,content:t,createdAtMs:e.createdAt.getTime(),clientId:e.clientId??void 0,userId:"user"in e?e.user?.id??void 0:void 0,guid:"nodeGuid"in e?e.nodeGuid??void 0:void 0,scenegraphSentAt:"scenegraphSentAt"in e?e.scenegraphSentAt??void 0:void 0})}function k({chatMessagesNode:e,disabled:t}){let r=(0,d.md)(p.ze),i=!t&&r&&e,{threadId:a,subscriptionStatus:n}=y({isEnabled:!!i,fileKey:r,nodeGuid:e?.guid||""}),o=!t&&i&&a,s=(0,f.Rs)((0,g.A6w)(o?{ownerId:r,id:a}:null),{enabled:!!o});return{thread:(s.data?.activeAiChatThread?(0,c.oA)(s.data.activeAiChatThread):null)??null,subscriptionStatus:s.status??n}}let S=100;function N({chatMessagesNode:e,disabled:t}){let r=(0,d.md)(p.ze),i=!t&&r&&e,{threadId:a,subscriptionStatus:n}=y({isEnabled:!!i,fileKey:r,nodeGuid:e?.guid||""}),o=(0,f.Rs)((0,g.nmx)(!t&&i&&a?{ownerId:r,id:a,firstPageSize:S}:null));return{thread:(o.data?.activeAiChatThread?(0,c.oA)(o.data.activeAiChatThread):null)??null,subscriptionStatus:o.status??n}}},129575:(e,t,r)=>{r.d(t,{KF:()=>h,YP:()=>g,di:()=>y,qD:()=>m});var i=r(716976),a=r(242069),n=r(989282);if(443==r.j)var o=r(347692);var s=r(318648),l=r(520199),d=r(211862),c=r(808242);if(443==r.j)var u=r(612691);if(443==r.j)var f=r(963433);if(443==r.j)var p=r(738591);function h(e,t){let r=g({overrideCodeLibraryNode:e===a.lV.FIGMAKE?t:null,disabled:e!==a.lV.FIGMAKE}),i=m({codeFileNode:e===a.lV.CODE_IN_SITES?t:null,disabled:e!==a.lV.CODE_IN_SITES}),n=y({codeFileNode:e===a.lV.FIGMAKE_IN_DESIGN?t:null,disabled:e!==a.lV.FIGMAKE_IN_DESIGN});switch(e){case a.lV.FIGMAKE:return r;case a.lV.CODE_IN_SITES:return i;case a.lV.FIGMAKE_IN_DESIGN:return n;default:throw Error(`Unsupported feature type: ${e}`)}}function g({overrideCodeLibraryNode:e,disabled:t}){let{codeLibraryInstance:r}=(0,f.oA)(),h=t?null:void 0!==e?e:r,g=(0,d.q5)(),m=g?.key??null,y=!!g?.canEdit,{status:b,data:v}=(0,c.Vc)(m),k="loaded"===b,S=(0,p.gO)(h),N=(0,p.eW)(h),I=!!(k&&v&&(0,o.G)(v)),{chatSdkState:w,chatSdkStatus:x}=function({fileKey:e,userCanEditFile:t,shouldQueryChatSdkState:r,chatMessagesNode:a,plan:o,nodeSource:d}){let c=i.useRef(!1),u=a?.guid||"",{threadId:f,isOldFile:p,subscriptionStatus:h}=(0,s.Sw)({isEnabled:!!(r&&e&&u),fileKey:e,nodeGuid:u}),g=p??d.getMessages().length>0,m=i.useRef(e),y=i.useRef(u),[b,v]=i.useState({threadId:f,isOldFile:g,errorOnCreateThread:!1}),k=null!==f&&(f!==b?.threadId||g!==b?.isOldFile),S=e!==m.current||u!==y.current;(k||S)&&(m.current=e,y.current=u,v({threadId:f,isOldFile:g,errorOnCreateThread:!1}));let N=e&&u&&"loaded"===h&&o&&r,I=N&&!t&&null===f;return N&&null===f&&t&&!c.current&&(c.current=!0,(0,n.q)({context:"code_chat",fileKey:e,plan:o,nodeGuid:u,isOldFile:g}).then(e=>{if("error"===e.status&&v({threadId:null,isOldFile:null,errorOnCreateThread:!0}),"created"===e.status){let{threadId:t,isOldFile:r}=e;(0,l.nH)(`Figmake AiChatThread created, id: ${t}, isOldFile?: ${r}`),v({threadId:t,isOldFile:r,errorOnCreateThread:!1})}})),i.useMemo(()=>{let{threadId:e,isOldFile:t,errorOnCreateThread:r}=b,i=h;return(r?i="errors":I&&(i="disabled"),e&&null!=t)?{chatSdkState:{threadId:e,isOldFile:t},chatSdkStatus:i}:{chatSdkState:void 0,chatSdkStatus:i}},[b,h,I])}({fileKey:m,userCanEditFile:y,chatMessagesNode:h,plan:v,shouldQueryChatSdkState:I,nodeSource:S}),O=I&&"errors"!==x&&"disabled"!==x,_=O&&(0,u.z)("make_chat_sdk_read")&&(!w?.isOldFile||(0,u.z)("make_chat_sdk_read_old_files"))&&((0,u.z)("make_chat_sdk_read_pagination")||S.getMessages().length<100);return i.useMemo(()=>{let e=_?N:S,t=[S];O&&t.push(N);let r=!!(k&&h&&(!O||w));return new a.F1({readingSource:e,writingSinks:t,isInitialized:r,node:h,chatSdkState:w,chatSdkPhase1Enabled:O,nodeChatSource:S})},[h,S,N,_,w,O,k])}function m({codeFileNode:e,disabled:t}){let r=t?null:e,n=(0,p.gO)(r);return i.useMemo(()=>new a.F1({readingSource:n,writingSinks:[n],node:r,chatSdkPhase1Enabled:!1,isInitialized:!!r,nodeChatSource:n}),[n,r])}function y({codeFileNode:e,disabled:t}){let r=t?null:e,n=(0,p.gO)(r);return i.useMemo(()=>new a.F1({readingSource:n,writingSinks:[n],node:r,chatSdkPhase1Enabled:!1,isInitialized:!!r,nodeChatSource:n}),[n,r])}},738591:(e,t,r)=>{r.d(t,{eW:()=>x,HL:()=>O,CQ:()=>N,gO:()=>S});var i=r(716976),a=r(242069),n=r(967325),o=r(400045),s=r(266808),l=r(442498),d=r(951002);async function c(e){let t={userId:e.userId,messageGuid:e.guid,createdAtMs:e.createdAtMs,scenegraphSentAt:e.scenegraphSentAt};switch(e.role){case"user":{let r=function(e,t){let r=(0,l.XL)(e,"code-chat-snapshot-restore");if(r){let e={type:"restore",plainText:"",codeSnapshot:{codeSnapshotKey:r.legacyS3CodeSnapshotKey,blobstoreContentKey:r.blobstoreContentKey},title:r.title},i=u(s.K$p.SYSTEM_MESSAGE,t);return i.textContent=JSON.stringify(e),i}let i=(0,l.XL)(e,"code-chat-manual-edit");if(i){let e={type:"manual_edit",plainText:"",changedFiles:i.changedFiles},r=u(s.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}let a=(0,l.XL)(e,"code-chat-duplicated-file");if(a){let e={type:"duplicated_file",plainText:a.plainText,fileKeyHash:a.fileKeyHash},r=u(s.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}let n=(0,l.XL)(e,"code-chat-deleted-chat-history");if(n){let e={type:"deleted_chat_history",plainText:"",userId:n.userId,timestamp:Number(n.timestamp)},r=u(s.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}}(e,t);if(r)return r;let i={plainText:"",imports:[]};for(let t of e.content)switch(t.type){case"text":i.plainText=t.text;break;case"selected-node-ids":break;case"code-chat-model-config-version":i.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-library-keys":i.libraryKey=t.libraryKeys[0],i.libraryKeys=[...t.libraryKeys];break;case"code-chat-errors":i.errors=[...t.errors],i.hidden=!0,i.plainText="";break;case"cortex-request-uuid":i.requestUuid=t.requestUuid;break;case"code-chat-origin":i.origin=t.origin;break;case"code-chat-inspected-component":i.inspectedComponent={filePath:t.filePath,tagName:t.tagName};break;case"code-chat-inspected-library":i.inspectedLibrary={folderPath:t.folderPath,libraryName:t.libraryName};break;case"code-chat-snapshot-restore":case"code-chat-manual-edit":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":throw new o.T(`${t.type} should have been handled by maybeHandleNodeChatSystemMessage. Probably a bug`);case"code-chat-backfill-image-import":i.imports.push({type:"image",guid:t.guid,imageHash:t.imageHash});break;case"code-chat-backfill-code-import":i.imports.push({type:"node",guid:t.guid,communityAttribution:t.communityAttribution});break;case"code-chat-backfill-diff-import":i.imports.push({type:"diff",guid:t.guid,diffs:t.diffs});break;case"code-chat-backfill-inspected-element":{let{type:e,...r}=t;i.inspectedElement=r;break}case"code-chat-code-import-ref":case"code-chat-image-import-ref":case"code-chat-diff-import-ref":case"code-chat-inspected-element-ref":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;case"image":case"jsx":throw new o.T(`Make does not support message part with type ${t.type}`);default:(0,d.xb)(t)}let n=u(s.K$p.USER_MESSAGE,t);return n.textContent=(0,a.J6)(i),n}case"assistant":{let r=[],i=[],n={plainText:""};for(let t of e.content)switch(t.type){case"text":throw new o.T("Cannot use 'text' for Code Chat assistant messages. Use 'code-chat-assistant-text' instead.");case"tool-call":r.push({toolCallId:t.toolCallId,toolName:t.toolName,argsJson:t.argsJSON});break;case"code-chat-legacy-assistant-tool-result":{let{type:e,...r}=t;i.push({...r});break}case"reasoning":t.signature?n.signedReasoning={text:t.text,signature:t.signature}:n.reasoning=[{text:t.text}];break;case"redacted-reasoning":n.redactedReasoning=t.data;break;case"code-chat-model-config-version":n.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-assistant-text":n.plainText=t.text,n.mode=t.textMode;break;case"code-chat-assistant-code":case"code-chat-provider-metadata":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;case"code-chat-assistant-title":n.title=t.title;break;case"code-chat-legacy-s3-code-snapshot":{let e=n.codeSnapshot??{};n.codeSnapshot={...e,codeSnapshotKey:t.codeSnapshotKey,fileVersionId:"-1"};break}case"code-chat-code-snapshot":{let e=n.codeSnapshot??{};n.codeSnapshot={...e,blobstoreContentKey:t.blobstoreContentKey,fileVersionId:"-1"};break}default:(0,d.xb)(t)}let l=u(s.K$p.ASSISTANT_MESSAGE,t);return l.textContent=(0,a.J6)(n),l.toolCalls=r,l.toolResults=i,l}case"tool":{let r=[],i={plainText:""};for(let t of e.content)switch(t.type){case"tool-result":r.push({toolCallId:t.toolCallId,toolName:t.toolName,resultJson:t.resultJSON});break;case"code-chat-model-config-version":i.modelConfigVersion=t.modelConfigVersion;break;case"tool-result-ref":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;default:(0,d.xb)(t)}let n=u(s.K$p.TOOL_MESSAGE,t);return n.textContent=(0,a.J6)(i),n.toolResults=r,n}case"system":throw new o.T("Chat SDK does not store system messages in the database (yet), we should never get here");default:(0,d.xb)(e)}}function u(e,t){let r=(0,a.ic)(e,t.userId??"placeholderUserId",()=>"placeholderMessageGuid");return void 0!==t.messageGuid&&(r.id=t.messageGuid),r.sentAt64=t.scenegraphSentAt??t.createdAtMs.toString(),r}var f=r(795033),p=r(318648),h=r(520199),g=r(106170),m=r(835307),y=r(252285),b=r(612691);let v="null-hash",k=(0,y.H)({hash:v,messages:[]});function S(e){let t=(0,m.Fk)((e,t)=>t?.chatMessagesHash??v,e),r=e?.guid||"",[n,o]=(0,f.fp)(k(r)),s=(0,f.Pj)(),l=i.useMemo(()=>!!(e&&n.hash!==v),[n.hash,e]);i.useEffect(()=>{e&&t&&t!==n.hash&&o({hash:t,messages:e.chatMessages_DEPRECATED||[],pendingMessages:void 0})},[e,t,n.hash,o,r]);let d=i.useCallback(()=>{let e=s.get(k(r));return e.pendingMessages??e.messages??[]},[s,r]),c=i.useCallback(t=>{if(l&&e){let i=(0,a.BM)(t);(0,g.r)(()=>e.chatMessages_DEPRECATED=i);let n=s.get(k(r));s.set(k(r),{...n,pendingMessages:(0,a.BM)(t)})}},[l,e,s,r]),u=i.useCallback(t=>{l&&e&&c([...(0,a.BM)(d()),...t])},[c,d,l,e]),p=i.useCallback(t=>{l&&e&&c(t((0,a.BM)(d())))},[d,l,e,c]);return i.useMemo(()=>({getMessages:d,appendMessages:u,editMessages:p,isInitialized:l}),[d,u,p,l])}function N(e){return(0,f.md)(k(e)).hash!==v}let I=(0,y.H)({messages:[]}),w=(0,y.H)({messages:[]});function x(e){let t=function(e){let[t,r]=(0,f.fp)(I(e?.guid||"")),a=i.useRef({numberOfMessages:0,lastMessageUpdatedAt:new Date(0),lastMessageId:""}),n=((0,b.z)("make_chat_sdk_read")&&(0,b.z)("make_chat_sdk_read_pagination"))??!1,o=(0,b.z)("make_chat_sdk_read")&&e,{thread:s,subscriptionStatus:l}=(0,p.sc)({chatMessagesNode:e,disabled:!o||n}),{thread:d,subscriptionStatus:c}=(0,p.p)({chatMessagesNode:e,disabled:!o||!n}),u=n?d:s,g=n?"loaded"!==c:"loaded"!==l,m=i.useMemo(()=>!!(!o||u&&!g),[o,u,g]),y=i.useMemo(()=>n?[...d?.paginatedMessages??[]].reverse():s?.messages??[],[n,d,s]);i.useEffect(()=>{if(!m||!u)return;let e=y.length,t=y[e-1],i=t?.updatedAt??new Date(0),n=t?.id??"";if(e!==a.current.numberOfMessages||n!==a.current.lastMessageId||i.getTime()!==a.current.lastMessageUpdatedAt.getTime()){let t=y.map(p.th);(0,h.nH)("Updating local cache with AiChatMessages",{thread:u,aiChatMessages:t}),r({messages:t??[]}),a.current={numberOfMessages:e,lastMessageUpdatedAt:i,lastMessageId:n}}},[u,m,r,y]);let v=i.useCallback(()=>t.messages,[t.messages]),k=i.useCallback(e=>[],[]),S=i.useCallback(()=>{},[]),N=i.useMemo(()=>{if(!n||!d)return;let e=d.paginatedMessages;return{loadNextPage:t=>{(0,h.nH)("Loading next page of messages",{count:t??p.bg}),e.loadNext(t??p.bg)},hasMore:e.hasNextPage(),isLoading:e.isLoadingNextPage,totalCount:void 0}},[n,d]);return i.useMemo(()=>({getMessages:v,editMessages:k,appendMessages:S,isInitialized:m,pagination:N}),[v,k,S,m,N])}(e),r=t.getMessages(),[a,n]=(0,f.fp)(w(e?.guid||"")),o=((0,b.z)("make_chat_sdk_read")&&(0,b.z)("make_chat_sdk_read_pagination"))??!1,s=i.useRef(!1);i.useEffect(()=>{0!==r.length&&(s.current=!0,Promise.all(r.map(async e=>await c(e))).then(e=>{(0,h.nH)("Converted chat messages from AI SDK to NodeChatMessages",{messages:r,convertedMessages:e,paginationEnabled:o}),n({messages:e})}).catch(e=>{(0,h.nH)("Error converting chat messages from AI SDK to NodeChatMessages",e),s.current=!1}))},[r,n,o]);let l=i.useMemo(()=>{let e=r.length===a.messages.length;return e&&(s.current=!1),e&&!s.current},[r.length,a.messages.length]),d=i.useCallback(()=>a.messages,[a.messages]),u=i.useCallback(e=>[],[]),g=i.useCallback(()=>{},[]),m=i.useMemo(()=>{if(t.pagination)return{...t.pagination,isLoading:t.pagination.isLoading||!l}},[t.pagination,l]);return i.useMemo(()=>({getMessages:d,editMessages:u,appendMessages:g,isInitialized:t.isInitialized,pagination:m}),[d,u,g,t.isInitialized,m])}function O(e){let t=e?.getMessages();return i.useMemo(()=>t?(0,n.Qf)((0,a.BM)(t)):[],[t])}},703375:(e,t,r)=>{if(r.d(t,{b:()=>h,e:()=>c}),443==r.j)var i=r(951002);var a=r(638004),n=r(208265),o=r.n(n),s=r(725837),l=r(743072),d=r(249586),c=(e=>(e.EmbedKit="embed_kit",e.DesignPlayableMakesOnCanvas="design_playable_makes_on_canvas",e.DesignInSeparateTabPreview="design_in_separate_tab_preview",e.DesignInFloatingModalPreview="design_in_floating_modal_preview",e.MakeStandalone="make_standalone",e.SitesInFloatingModal="sites_in_floating_modal",e.Testing="testing",e))(c||{});let u={code_bundle_start:null,code_bundle_stop:null,preview_website_bundle_start:null,preview_website_bundle_stop:null,asset_generation_start:null,asset_generation_stop:null,render_start:null,render_stop:null,sandbox_create_start:null,sandbox_create_stop:null,files_patch_start:null,files_patch_stop:null,update_package_json_start:null,update_package_json_stop:null,install_dependencies_start:null,install_dependencies_stop:null,import_module_start:null,import_module_stop:null,cached_preview_urls_load_start:null,cached_preview_urls_load_stop:null,cached_preview_iframe_load_start:null,cached_preview_iframe_load_stop:null},f={code_bundle_start:null,preview_website_bundle_start:null,asset_generation_start:null,render_start:null,sandbox_create_start:null,files_patch_start:null,update_package_json_start:null,install_dependencies_start:null,import_module_start:null,cached_preview_urls_load_start:null,cached_preview_iframe_load_start:null};function p({start:e,stop:t}){return Math.max(0,e&&t&&t-e||0)}class h{constructor({isFoundry:e,surface:t,codeLibraryFormat:r}){this.initTime=null,this.userFlow=null,this.buildMetadata=null,this.loadMetadata={},this.syncMetadata={},this.durationVitalMap={...f},this.timingMap={...u},this.isFirstBuild=!0,this.isFoundry=e,this.surface=t,this.codeLibraryFormat=r.toString()}reset(){this.timingMap={...u},this.durationVitalMap={...f},this.initTime=null,this.userFlow=null,this.isFirstBuild=!1,this.buildMetadata=null,this.loadMetadata={}}record(e){this.initTime||(this.initTime=performance.now()),this.userFlow||(this.userFlow=l.J.startUserFlow({name:"component_preview",team:a.e.MAKE,context:{is_foundry:this.isFoundry,is_first_build:this.isFirstBuild,surface:this.surface.toString(),code_library_format:this.codeLibraryFormat}})),null===this.timingMap[e]&&(this.recordDurationVital(e),this.timingMap[e]=performance.now())}recordDurationVital(e){if(this.userFlow)switch(e){case"code_bundle_start":case"preview_website_bundle_start":case"asset_generation_start":case"render_start":case"sandbox_create_start":case"files_patch_start":case"update_package_json_start":case"install_dependencies_start":case"import_module_start":case"cached_preview_urls_load_start":case"cached_preview_iframe_load_start":let t=this.userFlow.startDuration(e.replace("_start",""));t.addContext({is_foundry:this.isFoundry,is_first_build:this.isFirstBuild,surface:this.surface.toString(),code_library_format:this.codeLibraryFormat}),this.durationVitalMap[e]=t;break;case"code_bundle_stop":case"preview_website_bundle_stop":case"asset_generation_stop":case"render_stop":case"sandbox_create_stop":case"files_patch_stop":case"update_package_json_stop":case"install_dependencies_stop":case"import_module_stop":case"cached_preview_urls_load_stop":case"cached_preview_iframe_load_stop":let r=e.replace("_stop","_start");this.durationVitalMap[r]?.stop(),this.durationVitalMap[r]=null;break;default:(0,i.S9)(e,null)}}setBuildMetadata(e){this.buildMetadata=e}setLoadMetadata(e){this.loadMetadata={...this.loadMetadata,...e}}setSyncMetadata(e){this.syncMetadata={...this.syncMetadata,...e}}trackFigmentEvent(){let{code_bundle_start:e,code_bundle_stop:t,preview_website_bundle_start:r,preview_website_bundle_stop:i,asset_generation_start:a,asset_generation_stop:n,render_start:l,render_stop:c,sandbox_create_start:u,sandbox_create_stop:f,files_patch_start:h,files_patch_stop:g,update_package_json_start:m,update_package_json_stop:y,install_dependencies_start:b,install_dependencies_stop:v,import_module_start:k,import_module_stop:S,cached_preview_urls_load_start:N,cached_preview_urls_load_stop:I,cached_preview_iframe_load_start:w,cached_preview_iframe_load_stop:x}=this.timingMap;if(!this.initTime){console.error("Component preview performance tracker init time not set. Unable to track figment event.");return}let O=s.D.getState(),_=(this.buildMetadata?.isBuildSuccessful||this.isFoundry?c:t)??performance.now();(0,d.ds)("code_component_preview_perf",O.openFile?.key,o()(O,["selectedView","fileByKey"]),{is_foundry:this.isFoundry,surface:this.surface.toString(),code_library_format:this.codeLibraryFormat,total_build_and_render_ms:p({start:this.initTime,stop:_}),bundle_code_ms:p({start:e,stop:t}),preview_website_bundle_ms:p({start:r,stop:i}),asset_generation_ms:p({start:a,stop:n}),render_ms:p({start:l,stop:c}),sandbox_create_ms:p({start:u,stop:f}),files_patch_ms:p({start:h,stop:g}),update_package_json_ms:p({start:m,stop:y}),install_dependencies_ms:p({start:b,stop:v}),import_module_ms:p({start:k,stop:S}),cached_preview_urls_load_ms:p({start:N,stop:I}),cached_preview_iframe_load_ms:p({start:w,stop:x}),npm_install_duration_ms:this.syncMetadata?.npmInstallDuration??0,is_first_build:this.isFirstBuild,is_build_successful:this.buildMetadata?.isBuildSuccessful,is_cached_preview_urls_load_successful:this.loadMetadata?.isCachedPreviewUrlsLoadSuccessful,cached_from_template_id:this.loadMetadata?.cachedFromTemplateId??null,cached_from_template_type:this.loadMetadata?.cachedFromTemplateType??null,newly_provisioned:this.loadMetadata?.newlyProvisioned,error_message:this.buildMetadata?.errorMessage,bundle_js_length:this.buildMetadata?.bundleJsLength,bundle_css_length:this.buildMetadata?.bundleCssLength,total_library_code_files:this.buildMetadata?.totalCodeFiles,total_library_code_file_lines:this.buildMetadata?.totalCodeFileLines,total_library_image_imports:this.buildMetadata?.totalImageImports,source_code_hash:this.syncMetadata?.sourceCodeHash,is_sync_successful:this.syncMetadata?.isSyncSuccessful},{forwardToDatadog:!0}),this.userFlow?.end(),this.reset()}}},758813:(e,t,r)=>{r.d(t,{EY:()=>f,Er:()=>n,ME:()=>i,MF:()=>d,PD:()=>o,Rn:()=>s,U9:()=>u,UX:()=>a,X3:()=>h,bt:()=>l,dw:()=>p,mb:()=>g,pc:()=>c});let i=5e3,a=3,n=1e3,o=12e3,s=6e4,l=500,d=5e3,c=3,u=6e4,f=3,p=1e3,h=6e4,g=443==r.j?2e4:null},616197:(e,t,r)=>{r.d(t,{T:()=>x,A:()=>O});var i=r(32085),a=r(250700),n=r(208821),o=r(951002),s=r(221086),l=r(980852),d=r(812714),c=r(883765),u=r(755444),f=r(178623),p=r(20267),h=r(395556),g=r(616060),m=r(612953),y=r(581372),b=r(758813),v=r(277867),k=r(518016),S=r.n(k),N=(e=>(e.ABORTED="ABORTED",e.ALREADY_SYNCING="ALREADY_SYNCING",e.FAILURE="FAILURE",e.NOTHING_TO_SYNC="NOTHING_TO_SYNC",e.SYNCED="SYNCED",e))(N||{});class I{constructor({entrypointsByIdentifier:e,originHost:t,abortSignal:r,limitRetries:i,codeLibraryFormat:a,perfTracker:n,onSyncFailure:o,onResponse:s}){this.syncedItemsByGuid={},this.queuedItems=[],this.inFlightItems=[],this.sync=(e,t)=>(this.addToQueue(e,t),this.processQueue()),this.entrypointsByIdentifier=e,this.originHost=t,this.abortSignal=r,this.limitRetries=i,this.perfTracker=n,this.codeLibraryFormat=a,this.onSyncFailure=o,this.onResponse=s}addToQueue(e,t){for(let t of e.added)t.metadata.guid&&t.metadata.assetVersion&&this.queuedItems.push({type:"upsert",entry:{path:this.sanitizedPath(t.path),contents:t.contents.toString(),metadata:{version:this.sanitizedVersion(t.metadata.assetVersion),guid:t.metadata.guid}}});for(let t of[...e.updated,...e.moved])t.new.metadata.guid&&t.new.metadata.assetVersion&&this.queuedItems.push({type:"upsert",entry:{path:this.sanitizedPath(t.new.path),contents:t.new.contents.toString(),metadata:{version:this.sanitizedVersion(t.new.metadata.assetVersion),guid:t.new.metadata.guid}}});for(let t of e.removed)t.metadata.guid&&t.metadata.assetVersion&&this.queuedItems.push({type:"delete",entry:{path:this.sanitizedPath(t.path),metadata:{version:this.sanitizedVersion(t.metadata.assetVersion),guid:t.metadata.guid}}})}async processQueue(){if(this.inFlightItems.length>0)return"ALREADY_SYNCING";let e={};for(let t of this.queuedItems){let r=e[t.entry.metadata.guid]??this.syncedItemsByGuid[t.entry.metadata.guid]??null;this.shouldAcceptItem({currentItem:r,newItem:t})&&(e[t.entry.metadata.guid]=t)}this.queuedItems=[];let t=Object.values(e);if(!t.length)return"NOTHING_TO_SYNC";try{this.inFlightItems=[...t];let e=await this.syncItems(t);try{this.onResponse(e,"sync")}catch(e){}return this.syncedItemsByGuid={...this.syncedItemsByGuid,...S()(t,e=>e.entry.metadata.guid)},this.inFlightItems=[],this.processQueue(),"SYNCED"}catch(e){if(this.queuedItems.unshift(...t),this.inFlightItems=[],(0,n.z)(e))return"ABORTED";return this.onSyncFailure(e instanceof Error?e:Error(String(e))),"FAILURE"}}syncItems(e){return(0,s.OF)(async()=>{try{this.perfTracker.record("files_patch_start"),this.perfTracker.setSyncMetadata({sourceCodeHash:(0,a.N)().getSourceCodeHash()});let t=await f.Ay.foundry.sync({entrypointsByIdentifier:this.entrypointsByIdentifier,codeVfsEntryChanges:e,originHost:this.originHost,codeLibraryFormat:this.codeLibraryFormat},{...(0,p.Ay)()},{abortSignal:this.abortSignal});return this.perfTracker.setSyncMetadata({npmInstallDuration:t.npmInstallDuration,isSyncSuccessful:!0}),t}catch(e){throw this.perfTracker.setSyncMetadata({isSyncSuccessful:!1}),e}finally{this.perfTracker.record("files_patch_stop")}},{times:this.limitRetries?b.EY:void 0,interval:b.dw,exponentialBackoff:!0,maxBackoff:b.U9,abortSignal:this.abortSignal})}shouldAcceptItem({currentItem:e,newItem:t}){return!e||"delete"!==e.type&&("delete"===t.type||0>(0,v.CL)(e.entry.metadata.version,t.entry.metadata.version))}sanitizedVersion(e){return e.replace(/^\[/,"").replace(/\]$/,"")}sanitizedPath(e){return e.replace(/^\//,"")}}var w=(e=>(e.IDLE="IDLE",e.INITIALIZING_SANDBOX="INITIALIZING_SANDBOX",e.SANDBOX_READY="SANDBOX_READY",e.INITIALIZING_CODE="INITIALIZING_CODE",e.READY="READY",e.FAILED="FAILED",e))(w||{}),x=(e=>(e.CACHED_PREVIEW="CACHED_PREVIEW",e.FAILED="FAILED",e.PROVISIONING="PROVISIONING",e.REPROVISIONING="REPROVISIONING",e.PROVISIONED="PROVISIONED",e))(x||{});class O{constructor({originHost:e,fileKey:t,perfTracker:r}){this.syncer=null,this.sandboxUrl=null,this._codeLibraryFormat=0,this._destroyed=!1,this.currentState="IDLE",this.stateResolvers=new Map,this.attachHandlers=e=>{this.onStateChange=e.onStateChange},this.initializeSandbox=()=>this.destroyed||"IDLE"!==this.currentState&&"FAILED"!==this.currentState?Promise.resolve():("IDLE"===this.currentState&&c.az.trackDefinedEvent("foundry.file_open",{fileKey:this.fileKey,sourceCodeHash:this.vfs.getSourceCodeHash(),codeLibraryFormat:this.codeLibraryFormat.toString()}),this.transitionTo("INITIALIZING_SANDBOX")),this.initializeCode=async({fromTemplate:e})=>{if(this.destroyed)return Promise.resolve();let t=new Set(["READY","FAILED"]);return t.has(this.currentState)?Promise.resolve():(this.preloadCachedPreviewUrls({fromTemplate:e}).then(e=>{!e||t.has(this.currentState)||this.onStateChange?.({state:"CACHED_PREVIEW",cachedPreview:e})}).catch(()=>{}),"SANDBOX_READY"===await this.waitForState(["SANDBOX_READY","FAILED"]))?this.transitionTo("INITIALIZING_CODE"):void 0},this.destroy=()=>{this._destroyed=!0,this.abortController.abort(),this.stopListeningToVfsChanges()},this.waitForState=e=>{let t=new Set(Array.isArray(e)?e:[e]);return t.has(this.currentState)?Promise.resolve(this.currentState):new Promise(e=>{for(let r of t){let t=this.stateResolvers.get(r)||[];t.push(()=>{e(r)}),this.stateResolvers.set(r,t)}})},this.transitionTo=async(e,t)=>{let r=this.currentState;if(this.currentState=e,r===this.currentState)return;let i=this.stateResolvers.get(e);switch(i&&(i.forEach(e=>e()),this.stateResolvers.delete(e)),e){case"IDLE":case"SANDBOX_READY":break;case"INITIALIZING_SANDBOX":this.onStateChange?.({state:"IDLE"===r?"PROVISIONING":"REPROVISIONING"}),await this.doInitializeSandbox();break;case"INITIALIZING_CODE":await this.doInitializeCode();break;case"READY":this.sandboxUrl&&this.onStateChange?.({state:"PROVISIONED",url:this.sandboxUrl}),this.startKeepAlive();break;case"FAILED":{let e=t?.error??"Unknown error";this.onStateChange?.({state:"FAILED",error:e instanceof Error?e:Error(String(e))});break}default:(0,o.S9)(e,void 0,`Unknown state transition: ${e}`)}},this.resetSandbox=()=>{this.sandboxUrl=null,this.stopListeningToVfsChanges(),this.abortController.abort(),this.syncer=null,this.abortController=new AbortController,this.transitionTo("INITIALIZING_SANDBOX"),this.waitForState(["SANDBOX_READY","FAILED"]).then(e=>{"SANDBOX_READY"===e&&this.transitionTo("INITIALIZING_CODE")})},this.doInitializeSandbox=async()=>{this._codeLibraryFormat=l.getActiveTSSceneGraph().getLocalCodeLibraryOrNull()?.codeLibraryFormat??0;try{let e=await this.createSandbox();this.sandboxUrl=e.url}catch(e){(!(0,n.z)(e)||e instanceof Error&&e.message.includes("timed out"))&&(this.transitionTo("FAILED",{error:e}),c.az.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_createSandbox",fileKey:this.fileKey,codeLibraryFormat:this.codeLibraryFormat.toString(),error:e instanceof Error?e.message:String(e)}));return}this.transitionTo("SANDBOX_READY")},this.doInitializeCode=async()=>{try{let e=this.vfs.listFiles();if(this.startListeningToVfsChanges(),this.syncer=new I({entrypointsByIdentifier:this.vfs.getCodeIdentifierToEntrypoint(),originHost:this.originHost,abortSignal:this.abortController.signal,limitRetries:!this.uiFoundryEnabled,perfTracker:this.perfTracker,codeLibraryFormat:this.codeLibraryFormat,onSyncFailure:this.handleSyncFailure,onResponse:e=>{this.handleSandboxUrlResponse(e,"sync")}}),await this.syncer.sync({added:e,removed:[],moved:[],updated:[]},i.P.LOCAL)!==N.SYNCED)throw Error("Failure syncing files");this.transitionTo("READY")}catch(e){this.stopListeningToVfsChanges(),(0,n.z)(e)||(this.transitionTo("FAILED",{error:e}),c.az.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_sync",fileKey:this.fileKey,codeLibraryFormat:this.codeLibraryFormat.toString(),error:e instanceof Error?e.message:String(e)}))}},this.handleVfsEntriesChanged=(e,t)=>{this.syncer?.sync(e,t)},this.handleSyncFailure=e=>{this.stopListeningToVfsChanges(),(0,n.z)(e)||(this.transitionTo("FAILED",{error:e}),c.az.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,a.N)().getSourceCodeHash(),success:!1,codeLibraryFormat:this.codeLibraryFormat.toString(),error:e.message}))},this.handleSandboxUrlResponse=(e,t)=>{switch(this.sandboxUrl&&(!e.url||this.sandboxUrl!==e.url)&&this.resetSandbox(),t){case"sync":c.az.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,a.N)().getSourceCodeHash(),success:!0,codeLibraryFormat:this.codeLibraryFormat.toString()});break;case"keep-alive":c.az.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!0,codeLibraryFormat:this.codeLibraryFormat.toString()});break;default:(0,o.S9)(t,void 0,`Unknown source: ${t}`)}},this.startListeningToVfsChanges=()=>{this.vfs.on("entriesChanged",this.handleVfsEntriesChanged)},this.stopListeningToVfsChanges=()=>{this.vfs.off("entriesChanged",this.handleVfsEntriesChanged)},this.createSandbox=async()=>{let e=b.PD,t=new AbortController,r=setTimeout(()=>{t.abort()},e),i=()=>{t.abort()};this.abortController.signal.addEventListener("abort",i);try{return await (0,s.OF)(async()=>{try{this.perfTracker.record("sandbox_create_start");let e=await f.Ay.foundry.sandbox({originHost:this.originHost},{...(0,p.Ay)(),trackingSessionId:(0,u.Ay)().tracking_session_id},{abortSignal:this.abortController.signal});if("PROVISIONED"!==e.state)throw Error(`Sandbox not provisioned: ${e.state}`);return void 0!==e.newlyProvisioned&&this.perfTracker.setLoadMetadata({newlyProvisioned:e.newlyProvisioned}),e}finally{this.perfTracker.record("sandbox_create_stop")}},{times:b.UX,interval:b.Er,exponentialBackoff:!0,maxBackoff:b.ME,abortSignal:t.signal})}finally{if(r&&clearTimeout(r),this.abortController.signal.removeEventListener("abort",i),t.signal.aborted&&!this.abortController.signal.aborted)throw Error("Sandbox creation timed out")}},this.startKeepAlive=()=>{let e=setInterval(async()=>{try{if("visible"===document.visibilityState){let e=await f.Ay.foundry.keepAlive({},{...(0,p.Ay)(),trackingSessionId:(0,u.Ay)().tracking_session_id},{abortSignal:this.abortController.signal});this.handleSandboxUrlResponse(e,"keep-alive")}}catch(e){(0,n.z)(e)||c.az.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!1,codeLibraryFormat:this.codeLibraryFormatStr,error:e instanceof Error?e.message:String(e)})}},b.mb);this.abortController.signal.addEventListener("abort",()=>{clearInterval(e)})},this.preloadCachedPreviewUrls=async({fromTemplate:e})=>{if(!this.previewEnabled)return null;try{this.perfTracker.record("cached_preview_urls_load_start");let t=await (()=>{if(e){if(!this.templatePreviewEnabled)return null;switch(e.type){case h.n.HubFile:return g.H.getCachedPreviewUrls({hubFileId:e.template.id});case h.n.TeamTemplate:return y.q.getCachedPreviewUrls({templateFileKey:e.template.file_key});case h.n.TeamTemplateLg:return y.q.getCachedPreviewUrls({templateFileKey:e.template.fileKey});default:(0,o.xb)(e)}}return m.Z.getCachedPreviewUrls({fileKey:this.fileKey,sourceCodeHash:(0,a.N)().getSourceCodeHash()})})();if(!t)return null;return this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!0,cachedFromTemplateId:e?.template.id,cachedFromTemplateType:e?.type}),{jsUrl:t.data.meta.js_url,cssUrl:t.data.meta.css_url}}catch(t){return this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!1,cachedFromTemplateId:e?.template.id,cachedFromTemplateType:e?.type}),null}finally{this.perfTracker.record("cached_preview_urls_load_stop")}},this.originHost=e,this.abortController=new AbortController,this.perfTracker=r,this.vfs=(0,a.N)(),this.fileKey=t,this.previewEnabled=!!(0,d.kc)().make_foundry_cache_preview_client,this.templatePreviewEnabled=!!(0,d.kc)().make_foundry_template_cached_preview,this.uiFoundryEnabled=!!(0,d.kc)().make_foundry_ui_org||!!(0,d.kc)().make_foundry_ui_pro||!!(0,d.kc)().make_foundry_ui_starter}get codeLibraryFormat(){return this._codeLibraryFormat}get codeLibraryFormatStr(){return this.codeLibraryFormat.toString()}get destroyed(){return this._destroyed}get initialized(){return"IDLE"!==this.currentState}}},949299:(e,t,r)=>{r.d(t,{A:()=>m,F:()=>g});var i=r(716976),a=r(542653);if(443==r.j)var n=r(951002);var o=r(170627),s=r(795033),l=r(883765),d=r(744389),c=r(985416);if(443==r.j)var u=r(703375);if(443==r.j)var f=r(963433);if(443==r.j)var p=r(48104);if(443==r.j)var h=r(616197);let g=(0,c.Wh)(()=>(0,s.eU)(null));function m({fileKey:e,isFoundryEnabled:t,surface:r}){let c=new URL((0,s.md)(p.jD)).host,m=(0,a.ft)(),y=(0,d.MF)(new u.b({isFoundry:!0,surface:r,codeLibraryFormat:m})),[b,v]=(0,i.useState)(!1),k=(0,f.oA)().codeLibraryInstance,S=(0,i.useMemo)(()=>!!k,[k]),N=(0,i.useMemo)(()=>!b&&e&&t?new h.A({originHost:c,fileKey:e,perfTracker:y}):null,[b,e,t,c,y]);(0,i.useEffect)(()=>{t&&1>(0,a.ft)()&&o.l7.system("set-local-code-library-format",()=>{(0,a.lK)(1)})},[t]);let[I,w]=(0,s.fp)(g),x=(0,i.useCallback)(t=>{switch(t.state){case h.T.PROVISIONING:w({state:h.T.PROVISIONING,perfTracker:y});break;case h.T.CACHED_PREVIEW:w({state:h.T.CACHED_PREVIEW,cachedPreview:t.cachedPreview,perfTracker:y});break;case h.T.REPROVISIONING:w({state:h.T.REPROVISIONING,perfTracker:y});break;case h.T.PROVISIONED:w({state:h.T.PROVISIONED,url:t.url,perfTracker:y});break;case h.T.FAILED:N&&N.codeLibraryFormat<=1?(N.destroy(),v(!0),w(null),e&&l.az.trackDefinedEvent("foundry.fallback_to_esbuild",{fileKey:e,codeLibraryFormat:m.toString(),error:t.error.message})):w({state:h.T.FAILED,error:t.error.message,perfTracker:y});break;default:(0,n.S9)(t,void 0,"Unknown sandbox state change")}},[N,e,y,w,m]),O=(0,i.useCallback)(e=>{N&&N.initializeCode(e)},[N]);return(0,i.useEffect)(()=>{N?.attachHandlers({onStateChange:x})},void 0),(0,i.useEffect)(()=>{N&&!N.initialized&&S&&(w({state:h.T.PROVISIONING,perfTracker:y}),N.initializeSandbox())},[N,S,y,w]),(0,i.useEffect)(()=>()=>{N?.destroy()},[N]),(0,i.useMemo)(()=>null===I&&!b&&t?{sandbox:{state:h.T.PROVISIONING,perfTracker:y},setCodeReady:O}:{sandbox:I,setCodeReady:O},[I,b,t,y,O])}},523657:(e,t,r)=>{r.d(t,{t:()=>n});var i=r(716976),a=r(104076);let n=(0,i.memo)(function(e){return(0,a.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,"data-fpl-icon-size":"16",children:(0,a.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M7.646 6.404a.5.5 0 0 1 .707 0l2.122 2.121a.5.5 0 0 1-.708.707L8 7.465 6.232 9.232a.5.5 0 0 1-.707-.707z"})})})},32085:(e,t,r)=>{var i;r.d(t,{P:()=>i}),function(e){e[e.LOCAL=0]="LOCAL",e[e.REMOTE=1]="REMOTE"}(i||(i={}))},967325:(e,t,r)=>{r.d(t,{EY:()=>d,Qf:()=>s,gG:()=>l});var i=r(242069),a=r(266808);if(443==r.j)var n=r(289172);var o=r(621592);function s(e){let t=(0,n.A)(e);return t?t.filter(e=>e.type!==a.K$p.TOOL_MESSAGE).reduce((e,t)=>{let r=t.type===a.K$p.ASSISTANT_MESSAGE,n=t.toolCalls.length>0,s=0===(0,i.H5)(t.textContent||"").plainText.length;if(r&&n&&s){let r=e[e.length-1];return r?.type===a.K$p.ASSISTANT_MESSAGE&&(r.toolCalls=o([...r.toolCalls,...t.toolCalls],"toolCallId")),e}return[...e,t]},[]):[]}function l(e){let{hidden:t,errors:r}=e;return!!t&&!!r&&r.length>0&&e.origin!==i.zm.FIX_ERRORS_BUTTON}function d(e){let t=e.slice().reverse().find(e=>e.type===a.K$p.USER_MESSAGE);return t?t.id:null}},405242:(e,t,r)=>{r.d(t,{H:()=>s,pQ:()=>n});var i=r(400045),a=r(472846);function n(e){return a.g.includes(e)}function o(e,t){let r=(function(e){let t=a.l[e];if(null==t)throw new i.T(`Unknown message part type: ${e}. Did you add a new message part type to a proto file? Run \`pnpm --filter @figma/synapse-global generate-ai-chat-proto\` to regenerate Typescript bindings.`);return t})(e).decode(t);return{type:e,...r}}function s(e,t){try{return o(e,function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}(t))}catch(r){return o(e,function(e){let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2){let i=e.slice(r,r+2);t[r/2]=parseInt(i,16)}return t}(t))}}},472846:(e,t,r)=>{r.d(t,{g:()=>e2,l:()=>e3});var i=r(153379);function a(){return{selectedNodeIds:[]}}let n={encode(e,t=new i.fI){for(let r of e.selectedNodeIds)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),n=void 0===t?r.len:r.pos+t,o=a();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;o.selectedNodeIds.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return o},fromJSON:e=>({selectedNodeIds:s.Array.isArray(e?.selectedNodeIds)?e.selectedNodeIds.map(e=>s.String(e)):[]}),toJSON(e){let t={};return e.selectedNodeIds?.length&&(t.selectedNodeIds=e.selectedNodeIds),t},create:e=>n.fromPartial(e??{}),fromPartial(e){let t=a();return t.selectedNodeIds=e.selectedNodeIds?.map(e=>e)||[],t}},o={encode:(e,t=new i.fI)=>(""!==e.jsx&&t.uint32(10).string(e.jsx),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n={jsx:""};for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.jsx=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({jsx:null!=e.jsx?s.String(e.jsx):""}),toJSON(e){let t={};return""!==e.jsx&&(t.jsx=e.jsx),t},create:e=>o.fromPartial(e??{}),fromPartial(e){let t={jsx:""};return t.jsx=e.jsx??"",t}},s=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function l(){return{text:"",providerOptions:{}}}let d={encode:(e,t=new i.fI)=>(""!==e.text&&t.uint32(10).string(e.text),Object.entries(e.providerOptions).forEach(([e,r])=>{u.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=l();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.text=r.string();continue;case 2:{if(18!==e)break;let t=u.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({text:ee(e.text)?Z.String(e.text):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.text&&(t.text=e.text),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>d.fromPartial(e??{}),fromPartial(e){let t=l();return t.text=e.text??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function c(){return{key:"",value:""}}let u={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=c();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>u.fromPartial(e??{}),fromPartial(e){let t=c();return t.key=e.key??"",t.value=e.value??"",t}};function f(){return{textBlobstoreKey:"",providerOptions:{}}}let p={encode:(e,t=new i.fI)=>(""!==e.textBlobstoreKey&&t.uint32(10).string(e.textBlobstoreKey),Object.entries(e.providerOptions).forEach(([e,r])=>{g.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=f();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.textBlobstoreKey=r.string();continue;case 2:{if(18!==e)break;let t=g.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({textBlobstoreKey:ee(e.textBlobstoreKey)?Z.String(e.textBlobstoreKey):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.textBlobstoreKey&&(t.textBlobstoreKey=e.textBlobstoreKey),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>p.fromPartial(e??{}),fromPartial(e){let t=f();return t.textBlobstoreKey=e.textBlobstoreKey??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function h(){return{key:"",value:""}}let g={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=h();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>g.fromPartial(e??{}),fromPartial(e){let t=h();return t.key=e.key??"",t.value=e.value??"",t}};function m(){return{mimeType:void 0,providerOptions:{}}}let y={encode:(e,t=new i.fI)=>(void 0!==e.mimeType&&t.uint32(18).string(e.mimeType),Object.entries(e.providerOptions).forEach(([e,r])=>{v.encode({key:e,value:r},t.uint32(26).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=m();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 2:if(18!==e)break;n.mimeType=r.string();continue;case 3:{if(26!==e)break;let t=v.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({mimeType:ee(e.mimeType)?Z.String(e.mimeType):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(void 0!==e.mimeType&&(t.mimeType=e.mimeType),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>y.fromPartial(e??{}),fromPartial(e){let t=m();return t.mimeType=e.mimeType??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function b(){return{key:"",value:""}}let v={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=b();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>v.fromPartial(e??{}),fromPartial(e){let t=b();return t.key=e.key??"",t.value=e.value??"",t}};function k(){return{text:"",signature:void 0,providerOptions:{}}}let S={encode:(e,t=new i.fI)=>(""!==e.text&&t.uint32(10).string(e.text),void 0!==e.signature&&t.uint32(18).string(e.signature),Object.entries(e.providerOptions).forEach(([e,r])=>{I.encode({key:e,value:r},t.uint32(26).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=k();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.text=r.string();continue;case 2:if(18!==e)break;n.signature=r.string();continue;case 3:{if(26!==e)break;let t=I.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({text:ee(e.text)?Z.String(e.text):"",signature:ee(e.signature)?Z.String(e.signature):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.text&&(t.text=e.text),void 0!==e.signature&&(t.signature=e.signature),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>S.fromPartial(e??{}),fromPartial(e){let t=k();return t.text=e.text??"",t.signature=e.signature??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function N(){return{key:"",value:""}}let I={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=N();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>I.fromPartial(e??{}),fromPartial(e){let t=N();return t.key=e.key??"",t.value=e.value??"",t}};function w(){return{providerOptions:{}}}let x={encode:(e,t=new i.fI)=>(Object.entries(e.providerOptions).forEach(([e,r])=>{_.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=w();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 2:{if(18!==e)break;let t=_.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>x.fromPartial(e??{}),fromPartial(e){let t=w();return t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function O(){return{key:"",value:""}}let _={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=O();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>_.fromPartial(e??{}),fromPartial(e){let t=O();return t.key=e.key??"",t.value=e.value??"",t}};function C(){return{data:"",providerOptions:{}}}let j={encode:(e,t=new i.fI)=>(""!==e.data&&t.uint32(10).string(e.data),Object.entries(e.providerOptions).forEach(([e,r])=>{E.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=C();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.data=r.string();continue;case 2:{if(18!==e)break;let t=E.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({data:ee(e.data)?Z.String(e.data):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.data&&(t.data=e.data),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>j.fromPartial(e??{}),fromPartial(e){let t=C();return t.data=e.data??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function P(){return{key:"",value:""}}let E={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=P();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>E.fromPartial(e??{}),fromPartial(e){let t=P();return t.key=e.key??"",t.value=e.value??"",t}};function F(){return{providerOptions:{}}}let T={encode:(e,t=new i.fI)=>(Object.entries(e.providerOptions).forEach(([e,r])=>{J.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=F();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 2:{if(18!==e)break;let t=J.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>T.fromPartial(e??{}),fromPartial(e){let t=F();return t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function A(){return{key:"",value:""}}let J={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=A();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>J.fromPartial(e??{}),fromPartial(e){let t=A();return t.key=e.key??"",t.value=e.value??"",t}};function V(){return{toolCallId:"",toolName:"",providerOptions:{}}}let L={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),Object.entries(e.providerOptions).forEach(([e,r])=>{D.encode({key:e,value:r},t.uint32(34).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=V();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 4:{if(34!==e)break;let t=D.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?Z.String(e.toolCallId):"",toolName:ee(e.toolName)?Z.String(e.toolName):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>L.fromPartial(e??{}),fromPartial(e){let t=V();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function M(){return{key:"",value:""}}let D={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=M();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>D.fromPartial(e??{}),fromPartial(e){let t=M();return t.key=e.key??"",t.value=e.value??"",t}};function K(){return{toolCallId:"",toolName:"",isError:void 0,providerOptions:{}}}let R={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),void 0!==e.isError&&t.uint32(32).bool(e.isError),Object.entries(e.providerOptions).forEach(([e,r])=>{H.encode({key:e,value:r},t.uint32(42).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=K();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 4:if(32!==e)break;n.isError=r.bool();continue;case 5:{if(42!==e)break;let t=H.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?Z.String(e.toolCallId):"",toolName:ee(e.toolName)?Z.String(e.toolName):"",isError:ee(e.isError)?Z.Boolean(e.isError):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),void 0!==e.isError&&(t.isError=e.isError),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>R.fromPartial(e??{}),fromPartial(e){let t=K();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.isError=e.isError??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function U(){return{key:"",value:""}}let H={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=U();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>H.fromPartial(e??{}),fromPartial(e){let t=U();return t.key=e.key??"",t.value=e.value??"",t}};function G(){return{toolCallId:"",toolName:"",argsJson:"",providerOptions:{}}}let B={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.argsJson&&t.uint32(26).string(e.argsJson),Object.entries(e.providerOptions).forEach(([e,r])=>{$.encode({key:e,value:r},t.uint32(34).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=G();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 3:if(26!==e)break;n.argsJson=r.string();continue;case 4:{if(34!==e)break;let t=$.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?Z.String(e.toolCallId):"",toolName:ee(e.toolName)?Z.String(e.toolName):"",argsJson:ee(e.argsJson)?Z.String(e.argsJson):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.argsJson&&(t.argsJson=e.argsJson),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>B.fromPartial(e??{}),fromPartial(e){let t=G();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.argsJson=e.argsJson??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function z(){return{key:"",value:""}}let $={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=z();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>$.fromPartial(e??{}),fromPartial(e){let t=z();return t.key=e.key??"",t.value=e.value??"",t}};function Y(){return{toolCallId:"",toolName:"",resultJson:"",isError:void 0,providerOptions:{}}}let X={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.resultJson&&t.uint32(26).string(e.resultJson),void 0!==e.isError&&t.uint32(32).bool(e.isError),Object.entries(e.providerOptions).forEach(([e,r])=>{W.encode({key:e,value:r},t.uint32(42).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=Y();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 3:if(26!==e)break;n.resultJson=r.string();continue;case 4:if(32!==e)break;n.isError=r.bool();continue;case 5:{if(42!==e)break;let t=W.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?Z.String(e.toolCallId):"",toolName:ee(e.toolName)?Z.String(e.toolName):"",resultJson:ee(e.resultJson)?Z.String(e.resultJson):"",isError:ee(e.isError)?Z.Boolean(e.isError):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.resultJson&&(t.resultJson=e.resultJson),void 0!==e.isError&&(t.isError=e.isError),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>X.fromPartial(e??{}),fromPartial(e){let t=Y();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.resultJson=e.resultJson??"",t.isError=e.isError??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=Z.String(r)),e),{}),t}};function q(){return{key:"",value:""}}let W={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=q();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?Z.String(e.key):"",value:ee(e.value)?Z.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>W.fromPartial(e??{}),fromPartial(e){let t=q();return t.key=e.key??"",t.value=e.value??"",t}},Z=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function Q(e){return"object"==typeof e&&null!==e}function ee(e){return null!=e}let et={encode:(e,t=new i.fI)=>(""!==e.foo&&t.uint32(10).string(e.foo),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n={foo:""};for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.foo=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({foo:e1(e.foo)?e0.String(e.foo):""}),toJSON(e){let t={};return""!==e.foo&&(t.foo=e.foo),t},create:e=>et.fromPartial(e??{}),fromPartial(e){let t={foo:""};return t.foo=e.foo??"",t}};function er(){return{requestUuid:""}}let ei={encode:(e,t=new i.fI)=>(""!==e.requestUuid&&t.uint32(10).string(e.requestUuid),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=er();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.requestUuid=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({requestUuid:e1(e.requestUuid)?e0.String(e.requestUuid):""}),toJSON(e){let t={};return""!==e.requestUuid&&(t.requestUuid=e.requestUuid),t},create:e=>ei.fromPartial(e??{}),fromPartial(e){let t=er();return t.requestUuid=e.requestUuid??"",t}};function ea(){return{text:"",textMode:""}}let en={encode:(e,t=new i.fI)=>(""!==e.text&&t.uint32(10).string(e.text),""!==e.textMode&&t.uint32(18).string(e.textMode),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ea();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.text=r.string();continue;case 2:if(18!==e)break;n.textMode=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({text:e1(e.text)?e0.String(e.text):"",textMode:e1(e.textMode)?e0.String(e.textMode):""}),toJSON(e){let t={};return""!==e.text&&(t.text=e.text),""!==e.textMode&&(t.textMode=e.textMode),t},create:e=>en.fromPartial(e??{}),fromPartial(e){let t=ea();return t.text=e.text??"",t.textMode=e.textMode??"",t}};function eo(){return{code:"",codeFilePath:""}}let es={encode:(e,t=new i.fI)=>(""!==e.code&&t.uint32(10).string(e.code),""!==e.codeFilePath&&t.uint32(18).string(e.codeFilePath),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eo();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.code=r.string();continue;case 2:if(18!==e)break;n.codeFilePath=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({code:e1(e.code)?e0.String(e.code):"",codeFilePath:e1(e.codeFilePath)?e0.String(e.codeFilePath):""}),toJSON(e){let t={};return""!==e.code&&(t.code=e.code),""!==e.codeFilePath&&(t.codeFilePath=e.codeFilePath),t},create:e=>es.fromPartial(e??{}),fromPartial(e){let t=eo();return t.code=e.code??"",t.codeFilePath=e.codeFilePath??"",t}};function el(){return{modelConfigVersion:""}}let ed={encode:(e,t=new i.fI)=>(""!==e.modelConfigVersion&&t.uint32(10).string(e.modelConfigVersion),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=el();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.modelConfigVersion=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({modelConfigVersion:e1(e.modelConfigVersion)?e0.String(e.modelConfigVersion):""}),toJSON(e){let t={};return""!==e.modelConfigVersion&&(t.modelConfigVersion=e.modelConfigVersion),t},create:e=>ed.fromPartial(e??{}),fromPartial(e){let t=el();return t.modelConfigVersion=e.modelConfigVersion??"",t}};function ec(){return{title:""}}let eu={encode:(e,t=new i.fI)=>(""!==e.title&&t.uint32(10).string(e.title),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ec();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.title=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({title:e1(e.title)?e0.String(e.title):""}),toJSON(e){let t={};return""!==e.title&&(t.title=e.title),t},create:e=>eu.fromPartial(e??{}),fromPartial(e){let t=ec();return t.title=e.title??"",t}};function ef(){return{providerMetadataJson:""}}let ep={encode:(e,t=new i.fI)=>(""!==e.providerMetadataJson&&t.uint32(10).string(e.providerMetadataJson),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ef();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.providerMetadataJson=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({providerMetadataJson:e1(e.providerMetadataJson)?e0.String(e.providerMetadataJson):""}),toJSON(e){let t={};return""!==e.providerMetadataJson&&(t.providerMetadataJson=e.providerMetadataJson),t},create:e=>ep.fromPartial(e??{}),fromPartial(e){let t=ef();return t.providerMetadataJson=e.providerMetadataJson??"",t}},eh={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>eh.fromPartial(e??{}),fromPartial:e=>({})},eg={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>eg.fromPartial(e??{}),fromPartial:e=>({})},em={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>em.fromPartial(e??{}),fromPartial:e=>({})};function ey(){return{guid:"",imageHash:void 0}}let eb={encode:(e,t=new i.fI)=>(""!==e.guid&&t.uint32(10).string(e.guid),void 0!==e.imageHash&&t.uint32(18).string(e.imageHash),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ey();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.guid=r.string();continue;case 2:if(18!==e)break;n.imageHash=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({guid:e1(e.guid)?e0.String(e.guid):"",imageHash:e1(e.imageHash)?e0.String(e.imageHash):void 0}),toJSON(e){let t={};return""!==e.guid&&(t.guid=e.guid),void 0!==e.imageHash&&(t.imageHash=e.imageHash),t},create:e=>eb.fromPartial(e??{}),fromPartial(e){let t=ey();return t.guid=e.guid??"",t.imageHash=e.imageHash??void 0,t}};function ev(){return{guid:"",codeFiles:[],communityAttribution:void 0}}let ek={encode(e,t=new i.fI){for(let r of(""!==e.guid&&t.uint32(10).string(e.guid),e.codeFiles))eN.encode(r,t.uint32(18).fork()).join();return void 0!==e.communityAttribution&&ew.encode(e.communityAttribution,t.uint32(26).fork()).join(),t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ev();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.guid=r.string();continue;case 2:if(18!==e)break;n.codeFiles.push(eN.decode(r,r.uint32()));continue;case 3:if(26!==e)break;n.communityAttribution=ew.decode(r,r.uint32());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({guid:e1(e.guid)?e0.String(e.guid):"",codeFiles:e0.Array.isArray(e?.codeFiles)?e.codeFiles.map(e=>eN.fromJSON(e)):[],communityAttribution:e1(e.communityAttribution)?ew.fromJSON(e.communityAttribution):void 0}),toJSON(e){let t={};return""!==e.guid&&(t.guid=e.guid),e.codeFiles?.length&&(t.codeFiles=e.codeFiles.map(e=>eN.toJSON(e))),void 0!==e.communityAttribution&&(t.communityAttribution=ew.toJSON(e.communityAttribution)),t},create:e=>ek.fromPartial(e??{}),fromPartial(e){let t=ev();return t.guid=e.guid??"",t.codeFiles=e.codeFiles?.map(e=>eN.fromPartial(e))||[],t.communityAttribution=void 0!==e.communityAttribution&&null!==e.communityAttribution?ew.fromPartial(e.communityAttribution):void 0,t}};function eS(){return{codeFileGuid:"",fullFilePath:""}}let eN={encode:(e,t=new i.fI)=>(""!==e.codeFileGuid&&t.uint32(10).string(e.codeFileGuid),""!==e.fullFilePath&&t.uint32(18).string(e.fullFilePath),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eS();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.codeFileGuid=r.string();continue;case 2:if(18!==e)break;n.fullFilePath=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({codeFileGuid:e1(e.codeFileGuid)?e0.String(e.codeFileGuid):"",fullFilePath:e1(e.fullFilePath)?e0.String(e.fullFilePath):""}),toJSON(e){let t={};return""!==e.codeFileGuid&&(t.codeFileGuid=e.codeFileGuid),""!==e.fullFilePath&&(t.fullFilePath=e.fullFilePath),t},create:e=>eN.fromPartial(e??{}),fromPartial(e){let t=eS();return t.codeFileGuid=e.codeFileGuid??"",t.fullFilePath=e.fullFilePath??"",t}};function eI(){return{hubFileId:"",hubFileName:"",creatorName:""}}let ew={encode:(e,t=new i.fI)=>(""!==e.hubFileId&&t.uint32(10).string(e.hubFileId),""!==e.hubFileName&&t.uint32(18).string(e.hubFileName),""!==e.creatorName&&t.uint32(26).string(e.creatorName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eI();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.hubFileId=r.string();continue;case 2:if(18!==e)break;n.hubFileName=r.string();continue;case 3:if(26!==e)break;n.creatorName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({hubFileId:e1(e.hubFileId)?e0.String(e.hubFileId):"",hubFileName:e1(e.hubFileName)?e0.String(e.hubFileName):"",creatorName:e1(e.creatorName)?e0.String(e.creatorName):""}),toJSON(e){let t={};return""!==e.hubFileId&&(t.hubFileId=e.hubFileId),""!==e.hubFileName&&(t.hubFileName=e.hubFileName),""!==e.creatorName&&(t.creatorName=e.creatorName),t},create:e=>ew.fromPartial(e??{}),fromPartial(e){let t=eI();return t.hubFileId=e.hubFileId??"",t.hubFileName=e.hubFileName??"",t.creatorName=e.creatorName??"",t}};function ex(){return{guid:"",diffs:""}}let eO={encode:(e,t=new i.fI)=>(""!==e.guid&&t.uint32(10).string(e.guid),""!==e.diffs&&t.uint32(18).string(e.diffs),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ex();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.guid=r.string();continue;case 2:if(18!==e)break;n.diffs=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({guid:e1(e.guid)?e0.String(e.guid):"",diffs:e1(e.diffs)?e0.String(e.diffs):""}),toJSON(e){let t={};return""!==e.guid&&(t.guid=e.guid),""!==e.diffs&&(t.diffs=e.diffs),t},create:e=>eO.fromPartial(e??{}),fromPartial(e){let t=ex();return t.guid=e.guid??"",t.diffs=e.diffs??"",t}};function e_(){return{codeSnapshotKey:""}}let eC={encode:(e,t=new i.fI)=>(""!==e.codeSnapshotKey&&t.uint32(10).string(e.codeSnapshotKey),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=e_();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.codeSnapshotKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({codeSnapshotKey:e1(e.codeSnapshotKey)?e0.String(e.codeSnapshotKey):""}),toJSON(e){let t={};return""!==e.codeSnapshotKey&&(t.codeSnapshotKey=e.codeSnapshotKey),t},create:e=>eC.fromPartial(e??{}),fromPartial(e){let t=e_();return t.codeSnapshotKey=e.codeSnapshotKey??"",t}},ej={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>ej.fromPartial(e??{}),fromPartial:e=>({})};function eP(){return{errors:[]}}let eE={encode(e,t=new i.fI){for(let r of e.errors)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eP();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.errors.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({errors:e0.Array.isArray(e?.errors)?e.errors.map(e=>e0.String(e)):[]}),toJSON(e){let t={};return e.errors?.length&&(t.errors=e.errors),t},create:e=>eE.fromPartial(e??{}),fromPartial(e){let t=eP();return t.errors=e.errors?.map(e=>e)||[],t}};function eF(){return{libraryKeys:[]}}let eT={encode(e,t=new i.fI){for(let r of e.libraryKeys)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eF();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.libraryKeys.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({libraryKeys:e0.Array.isArray(e?.libraryKeys)?e.libraryKeys.map(e=>e0.String(e)):[]}),toJSON(e){let t={};return e.libraryKeys?.length&&(t.libraryKeys=e.libraryKeys),t},create:e=>eT.fromPartial(e??{}),fromPartial(e){let t=eF();return t.libraryKeys=e.libraryKeys?.map(e=>e)||[],t}};function eA(){return{filePath:"",snippetStartLine:0,tagLine:0,tagName:""}}let eJ={encode:(e,t=new i.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),0!==e.snippetStartLine&&t.uint32(16).int32(e.snippetStartLine),0!==e.tagLine&&t.uint32(24).int32(e.tagLine),""!==e.tagName&&t.uint32(34).string(e.tagName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eA();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.filePath=r.string();continue;case 2:if(16!==e)break;n.snippetStartLine=r.int32();continue;case 3:if(24!==e)break;n.tagLine=r.int32();continue;case 4:if(34!==e)break;n.tagName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({filePath:e1(e.filePath)?e0.String(e.filePath):"",snippetStartLine:e1(e.snippetStartLine)?e0.Number(e.snippetStartLine):0,tagLine:e1(e.tagLine)?e0.Number(e.tagLine):0,tagName:e1(e.tagName)?e0.String(e.tagName):""}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),0!==e.snippetStartLine&&(t.snippetStartLine=Math.round(e.snippetStartLine)),0!==e.tagLine&&(t.tagLine=Math.round(e.tagLine)),""!==e.tagName&&(t.tagName=e.tagName),t},create:e=>eJ.fromPartial(e??{}),fromPartial(e){let t=eA();return t.filePath=e.filePath??"",t.snippetStartLine=e.snippetStartLine??0,t.tagLine=e.tagLine??0,t.tagName=e.tagName??"",t}};function eV(){return{filePath:"",snippetStartLine:0,tagLine:0,snippet:"",tagName:"",fileImports:void 0,componentHeader:void 0}}let eL={encode:(e,t=new i.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),0!==e.snippetStartLine&&t.uint32(16).int32(e.snippetStartLine),0!==e.tagLine&&t.uint32(24).int32(e.tagLine),""!==e.snippet&&t.uint32(34).string(e.snippet),""!==e.tagName&&t.uint32(42).string(e.tagName),void 0!==e.fileImports&&t.uint32(50).string(e.fileImports),void 0!==e.componentHeader&&t.uint32(58).string(e.componentHeader),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eV();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.filePath=r.string();continue;case 2:if(16!==e)break;n.snippetStartLine=r.int32();continue;case 3:if(24!==e)break;n.tagLine=r.int32();continue;case 4:if(34!==e)break;n.snippet=r.string();continue;case 5:if(42!==e)break;n.tagName=r.string();continue;case 6:if(50!==e)break;n.fileImports=r.string();continue;case 7:if(58!==e)break;n.componentHeader=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({filePath:e1(e.filePath)?e0.String(e.filePath):"",snippetStartLine:e1(e.snippetStartLine)?e0.Number(e.snippetStartLine):0,tagLine:e1(e.tagLine)?e0.Number(e.tagLine):0,snippet:e1(e.snippet)?e0.String(e.snippet):"",tagName:e1(e.tagName)?e0.String(e.tagName):"",fileImports:e1(e.fileImports)?e0.String(e.fileImports):void 0,componentHeader:e1(e.componentHeader)?e0.String(e.componentHeader):void 0}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),0!==e.snippetStartLine&&(t.snippetStartLine=Math.round(e.snippetStartLine)),0!==e.tagLine&&(t.tagLine=Math.round(e.tagLine)),""!==e.snippet&&(t.snippet=e.snippet),""!==e.tagName&&(t.tagName=e.tagName),void 0!==e.fileImports&&(t.fileImports=e.fileImports),void 0!==e.componentHeader&&(t.componentHeader=e.componentHeader),t},create:e=>eL.fromPartial(e??{}),fromPartial(e){let t=eV();return t.filePath=e.filePath??"",t.snippetStartLine=e.snippetStartLine??0,t.tagLine=e.tagLine??0,t.snippet=e.snippet??"",t.tagName=e.tagName??"",t.fileImports=e.fileImports??void 0,t.componentHeader=e.componentHeader??void 0,t}};function eM(){return{filePath:"",tagName:""}}let eD={encode:(e,t=new i.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),""!==e.tagName&&t.uint32(18).string(e.tagName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eM();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.filePath=r.string();continue;case 2:if(18!==e)break;n.tagName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({filePath:e1(e.filePath)?e0.String(e.filePath):"",tagName:e1(e.tagName)?e0.String(e.tagName):""}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),""!==e.tagName&&(t.tagName=e.tagName),t},create:e=>eD.fromPartial(e??{}),fromPartial(e){let t=eM();return t.filePath=e.filePath??"",t.tagName=e.tagName??"",t}};function eK(){return{folderPath:"",libraryName:void 0}}let eR={encode:(e,t=new i.fI)=>(""!==e.folderPath&&t.uint32(10).string(e.folderPath),void 0!==e.libraryName&&t.uint32(18).string(e.libraryName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eK();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.folderPath=r.string();continue;case 2:if(18!==e)break;n.libraryName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({folderPath:e1(e.folderPath)?e0.String(e.folderPath):"",libraryName:e1(e.libraryName)?e0.String(e.libraryName):void 0}),toJSON(e){let t={};return""!==e.folderPath&&(t.folderPath=e.folderPath),void 0!==e.libraryName&&(t.libraryName=e.libraryName),t},create:e=>eR.fromPartial(e??{}),fromPartial(e){let t=eK();return t.folderPath=e.folderPath??"",t.libraryName=e.libraryName??void 0,t}};function eU(){return{origin:""}}let eH={encode:(e,t=new i.fI)=>(""!==e.origin&&t.uint32(10).string(e.origin),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eU();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.origin=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({origin:e1(e.origin)?e0.String(e.origin):""}),toJSON(e){let t={};return""!==e.origin&&(t.origin=e.origin),t},create:e=>eH.fromPartial(e??{}),fromPartial(e){let t=eU();return t.origin=e.origin??"",t}};function eG(){return{toolCallId:"",toolName:"",resultJson:""}}let eB={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.resultJson&&t.uint32(26).string(e.resultJson),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eG();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 3:if(26!==e)break;n.resultJson=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:e1(e.toolCallId)?e0.String(e.toolCallId):"",toolName:e1(e.toolName)?e0.String(e.toolName):"",resultJson:e1(e.resultJson)?e0.String(e.resultJson):""}),toJSON(e){let t={};return""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.resultJson&&(t.resultJson=e.resultJson),t},create:e=>eB.fromPartial(e??{}),fromPartial(e){let t=eG();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.resultJson=e.resultJson??"",t}};function ez(){return{changedFilesJson:"",title:"",legacyS3CodeSnapshotKey:void 0}}let e$={encode:(e,t=new i.fI)=>(""!==e.changedFilesJson&&t.uint32(10).string(e.changedFilesJson),""!==e.title&&t.uint32(18).string(e.title),void 0!==e.legacyS3CodeSnapshotKey&&t.uint32(26).string(e.legacyS3CodeSnapshotKey),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ez();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.changedFilesJson=r.string();continue;case 2:if(18!==e)break;n.title=r.string();continue;case 3:if(26!==e)break;n.legacyS3CodeSnapshotKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({changedFilesJson:e1(e.changedFilesJson)?e0.String(e.changedFilesJson):"",title:e1(e.title)?e0.String(e.title):"",legacyS3CodeSnapshotKey:e1(e.legacyS3CodeSnapshotKey)?e0.String(e.legacyS3CodeSnapshotKey):void 0}),toJSON(e){let t={};return""!==e.changedFilesJson&&(t.changedFilesJson=e.changedFilesJson),""!==e.title&&(t.title=e.title),void 0!==e.legacyS3CodeSnapshotKey&&(t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey),t},create:e=>e$.fromPartial(e??{}),fromPartial(e){let t=ez();return t.changedFilesJson=e.changedFilesJson??"",t.title=e.title??"",t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey??void 0,t}};function eY(){return{plainText:"",fileKeyHash:""}}let eX={encode:(e,t=new i.fI)=>(""!==e.plainText&&t.uint32(10).string(e.plainText),""!==e.fileKeyHash&&t.uint32(18).string(e.fileKeyHash),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eY();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.plainText=r.string();continue;case 2:if(18!==e)break;n.fileKeyHash=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({plainText:e1(e.plainText)?e0.String(e.plainText):"",fileKeyHash:e1(e.fileKeyHash)?e0.String(e.fileKeyHash):""}),toJSON(e){let t={};return""!==e.plainText&&(t.plainText=e.plainText),""!==e.fileKeyHash&&(t.fileKeyHash=e.fileKeyHash),t},create:e=>eX.fromPartial(e??{}),fromPartial(e){let t=eY();return t.plainText=e.plainText??"",t.fileKeyHash=e.fileKeyHash??"",t}};function eq(){return{userId:"",timestamp:""}}let eW={encode:(e,t=new i.fI)=>(""!==e.userId&&t.uint32(10).string(e.userId),""!==e.timestamp&&t.uint32(18).string(e.timestamp),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eq();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.userId=r.string();continue;case 2:if(18!==e)break;n.timestamp=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({userId:e1(e.userId)?e0.String(e.userId):"",timestamp:e1(e.timestamp)?e0.String(e.timestamp):""}),toJSON(e){let t={};return""!==e.userId&&(t.userId=e.userId),""!==e.timestamp&&(t.timestamp=e.timestamp),t},create:e=>eW.fromPartial(e??{}),fromPartial(e){let t=eq();return t.userId=e.userId??"",t.timestamp=e.timestamp??"",t}};function eZ(){return{title:"",legacyS3CodeSnapshotKey:void 0,blobstoreContentKey:void 0}}let eQ={encode:(e,t=new i.fI)=>(""!==e.title&&t.uint32(10).string(e.title),void 0!==e.legacyS3CodeSnapshotKey&&t.uint32(18).string(e.legacyS3CodeSnapshotKey),void 0!==e.blobstoreContentKey&&t.uint32(26).string(e.blobstoreContentKey),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eZ();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.title=r.string();continue;case 2:if(18!==e)break;n.legacyS3CodeSnapshotKey=r.string();continue;case 3:if(26!==e)break;n.blobstoreContentKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({title:e1(e.title)?e0.String(e.title):"",legacyS3CodeSnapshotKey:e1(e.legacyS3CodeSnapshotKey)?e0.String(e.legacyS3CodeSnapshotKey):void 0,blobstoreContentKey:e1(e.blobstoreContentKey)?e0.String(e.blobstoreContentKey):void 0}),toJSON(e){let t={};return""!==e.title&&(t.title=e.title),void 0!==e.legacyS3CodeSnapshotKey&&(t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey),void 0!==e.blobstoreContentKey&&(t.blobstoreContentKey=e.blobstoreContentKey),t},create:e=>eQ.fromPartial(e??{}),fromPartial(e){let t=eZ();return t.title=e.title??"",t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey??void 0,t.blobstoreContentKey=e.blobstoreContentKey??void 0,t}},e0=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function e1(e){return null!=e}let e2=["selected-node-ids","jsx","text","text-ref","image-ref","reasoning","reasoning-ref","redacted-reasoning","redacted-reasoning-ref","tool-call-ref","tool-result-ref","tool-call-json-DO-NOT-USE-IN-PROD","tool-result-json-DO-NOT-USE-IN-PROD","figmake-test-part","cortex-request-uuid","code-chat-assistant-text","code-chat-assistant-code","code-chat-model-config-version","code-chat-assistant-title","code-chat-provider-metadata","code-chat-code-import-ref","code-chat-image-import-ref","code-chat-diff-import-ref","code-chat-backfill-image-import","code-chat-backfill-code-import","code-chat-backfill-diff-import","code-chat-legacy-s3-code-snapshot","code-chat-code-snapshot","code-chat-errors","code-chat-library-keys","code-chat-inspected-element-ref","code-chat-backfill-inspected-element","code-chat-inspected-component","code-chat-inspected-library","code-chat-origin","code-chat-legacy-assistant-tool-result","code-chat-manual-edit","code-chat-duplicated-file","code-chat-deleted-chat-history","code-chat-snapshot-restore"],e3={"selected-node-ids":n,jsx:o,text:d,"text-ref":p,"image-ref":y,reasoning:S,"reasoning-ref":x,"redacted-reasoning":j,"redacted-reasoning-ref":T,"tool-call-ref":L,"tool-result-ref":R,"tool-call-json-DO-NOT-USE-IN-PROD":B,"tool-result-json-DO-NOT-USE-IN-PROD":X,"figmake-test-part":et,"cortex-request-uuid":ei,"code-chat-assistant-text":en,"code-chat-assistant-code":es,"code-chat-model-config-version":ed,"code-chat-assistant-title":eu,"code-chat-provider-metadata":ep,"code-chat-code-import-ref":eh,"code-chat-image-import-ref":eg,"code-chat-diff-import-ref":em,"code-chat-backfill-image-import":eb,"code-chat-backfill-code-import":ek,"code-chat-backfill-diff-import":eO,"code-chat-legacy-s3-code-snapshot":eC,"code-chat-code-snapshot":ej,"code-chat-errors":eE,"code-chat-library-keys":eT,"code-chat-inspected-element-ref":eJ,"code-chat-backfill-inspected-element":eL,"code-chat-inspected-component":eD,"code-chat-inspected-library":eR,"code-chat-origin":eH,"code-chat-legacy-assistant-tool-result":eB,"code-chat-manual-edit":e$,"code-chat-duplicated-file":eX,"code-chat-deleted-chat-history":eW,"code-chat-snapshot-restore":eQ}},370012:(e,t,r)=>{r.d(t,{N:()=>c,t:()=>d});var i=r(400045),a=r(723584),n=r(472846),o=r(405242),s=r(839903);if(443==r.j)var l=r(951002);function d(e){let t=structuredClone(e);switch(t.type){case"text":case"reasoning":case"redacted-reasoning":return{...t,providerOptions:{}};case"selected-node-ids":case"jsx":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-text":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-origin":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-backfill-image-import":case"code-chat-backfill-diff-import":case"code-chat-backfill-inspected-element":return t;case"tool-call":{let{toolCallId:e,toolName:r,argsJSON:i}=t;return{type:"tool-call-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,argsJson:i,providerOptions:{}}}case"tool-result":{let{toolCallId:e,toolName:r,resultJSON:i,isError:a}=t;return{type:"tool-result-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,resultJson:i,isError:a,providerOptions:{}}}case"tool-result-ref":{let{toolCallId:e,toolName:r,blobstoreContentKey:i,isError:a}=t;return{type:"tool-result-ref",toolCallId:e,toolName:r,isError:a,providerOptions:{}}}case"code-chat-backfill-code-import":{let{codeFiles:e,...r}=t;return{...r,codeFiles:e??[]}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadataJson:JSON.stringify(t.providerMetadata)};case"code-chat-code-import-ref":case"code-chat-image-import-ref":case"code-chat-diff-import-ref":case"code-chat-code-snapshot":return{type:t.type};case"code-chat-inspected-element-ref":{let{blobstoreContentKey:e,...r}=t;return r}case"code-chat-inspected-component":return{type:t.type,filePath:t.filePath,tagName:t.tagName};case"code-chat-inspected-library":return{type:t.type,folderPath:t.folderPath,libraryName:t.libraryName};case"code-chat-manual-edit":return{type:t.type,changedFilesJson:JSON.stringify(t.changedFiles),title:t.title,legacyS3CodeSnapshotKey:t.legacyS3CodeSnapshotKey};case"code-chat-duplicated-file":return{type:t.type,plainText:t.plainText,fileKeyHash:t.fileKeyHash};case"code-chat-deleted-chat-history":return{type:t.type,timestamp:t.timestamp,userId:t.userId??""};case"image":throw new i.T(`Not implemented: Conversion from part type ${t.type} to protobuf not implemented`);default:(0,l.xb)(t)}}function c({type:e,contentJson:t,blobstoreContentKey:r}){if(!(0,o.pQ)(e))throw new i.T(`Unknown message part type: ${e}`);let d=n.l[e].fromJSON(t),c={type:e,...d};switch(c.type){case"text":case"reasoning":case"redacted-reasoning":case"selected-node-ids":case"jsx":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":case"code-chat-backfill-image-import":case"code-chat-backfill-code-import":case"code-chat-backfill-diff-import":case"code-chat-backfill-inspected-element":return c;case"code-chat-manual-edit":{let e;let{title:t,changedFilesJson:r,legacyS3CodeSnapshotKey:n}=d;try{let t=JSON.parse(r);e=a.Op.shape.changedFiles.parse(t)}catch(t){let e=t instanceof Error?t.message:String(t);throw new i.T(`Invalid changedFiles for code-chat-manual-edit: ${e}`)}return{type:"code-chat-manual-edit",changedFiles:e,title:t,legacyS3CodeSnapshotKey:n,blobstoreContentKey:void 0}}case"code-chat-origin":{let{origin:e}=d,t=a.Iw.shape.origin.safeParse(e);if(!t.success)throw new i.T(`Invalid origin for code-chat-origin: ${e}`);return{type:"code-chat-origin",origin:t.data}}case"tool-call-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,argsJson:r}=d;return{type:"tool-call",toolCallId:e,toolName:t,argsJSON:r}}case"tool-result-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,resultJson:r,isError:i}=d;return{type:"tool-result",toolCallId:e,toolName:t,resultJSON:r,isError:i}}case"tool-result-ref":{if(!r)throw new i.T("Blobstore content key is required for tool-result-ref");let{toolCallId:e,toolName:t,isError:a}=d;return{type:"tool-result-ref",toolCallId:e,toolName:t,isError:a,blobstoreContentKey:r}}case"code-chat-assistant-text":{let{text:e,textMode:t}=d,r=s.w_.safeParse(t);if(!r.success)throw new i.T(`Invalid textMode for code-chat-assistant-text: ${t}`);if("code"===r.data)throw new i.T("Code mode messages should be represented by code-chat-assistant-code, not code-chat-assistant-text");return{type:"code-chat-assistant-text",text:e,textMode:r.data}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadata:JSON.parse(d.providerMetadataJson)};case"code-chat-code-snapshot":if(!r)throw new i.T("Blobstore content key is required for code-chat-code-snapshot");return{type:"code-chat-code-snapshot",blobstoreContentKey:r};case"code-chat-image-import-ref":if(!r)throw new i.T("Blobstore content key is required for code-chat-image-import-ref");return{type:"code-chat-image-import-ref",blobstoreContentKey:r};case"code-chat-code-import-ref":if(!r)throw new i.T("Blobstore content key is required for code-chat-code-import-ref");return{type:"code-chat-code-import-ref",blobstoreContentKey:r};case"code-chat-diff-import-ref":if(!r)throw new i.T("Blobstore content key is required for code-chat-diff-import-ref");return{type:"code-chat-diff-import-ref",blobstoreContentKey:r};case"code-chat-inspected-element-ref":{if(!r)throw new i.T("Blobstore content key is required for code-chat-inspected-element-ref");let{filePath:e,snippetStartLine:t,tagLine:a,tagName:n}=d;return{type:"code-chat-inspected-element-ref",filePath:e,snippetStartLine:t,tagLine:a,tagName:n,blobstoreContentKey:r}}case"code-chat-inspected-component":{let{filePath:e,tagName:t}=d;return{type:"code-chat-inspected-component",filePath:e,tagName:t}}case"code-chat-inspected-library":{let{folderPath:e,libraryName:t}=d;return{type:"code-chat-inspected-library",folderPath:e,libraryName:t}}case"text-ref":case"image-ref":case"reasoning-ref":case"redacted-reasoning-ref":case"tool-call-ref":case"figmake-test-part":throw new i.T(`Not implemented: Conversion from pb MessagePart type ${c.type} to AnyPart not implemented`);default:(0,l.xb)(c)}}},208821:(e,t,r)=>{function i(){return new DOMException("Operation aborted by user.","AbortError")}function a(e){return e instanceof DOMException&&"AbortError"===e.name}r.d(t,{N:()=>i,z:()=>a})}}]);

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/4b98fd7c76ac30a42835e25a0f12d8f4f0d7eecf/1211-153b1ac898d01d63.min.js.map